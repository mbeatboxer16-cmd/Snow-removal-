<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é™¤é›ªç®¡ç†">
    <meta name="theme-color" content="#0a0e27">
    <meta name="description" content="æ°‘é–“é™¤é›ªä½œæ¥­ã®å‡ºæ¥é«˜ç®¡ç†ã‚¢ãƒ—ãƒª - SNOW OPS">

```
<!-- PWA Icons -->
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%230a0e27'/><text x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='256' fill='%2300d4ff'>â„ï¸</text></svg>">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>â„ï¸</text></svg>">

<title>é™¤é›ªå‡ºæ¥é«˜ç®¡ç† - SNOW OPS</title>

<!-- Manifest inline -->
<link rel="manifest" href="data:application/manifest+json,{
    'name': 'é™¤é›ªå‡ºæ¥é«˜ç®¡ç† SNOW OPS',
    'short_name': 'SNOW OPS',
    'description': 'æ°‘é–“é™¤é›ªä½œæ¥­ã®å‡ºæ¥é«˜ç®¡ç†ã‚¢ãƒ—ãƒª',
    'start_url': './',
    'display': 'standalone',
    'background_color': '%230a0e27',
    'theme_color': '%2300d4ff',
    'orientation': 'portrait',
    'icons': [{
        'src': 'data:image/svg+xml,<svg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 512 512%27><rect width=%27512%27 height=%27512%27 fill=%27%230a0e27%27/><text x=%2750%25%27 y=%2750%25%27 dominant-baseline=%27middle%27 text-anchor=%27middle%27 font-size=%27256%27 fill=%27%2300d4ff%27>â„ï¸</text></svg>',
        'sizes': '512x512',
        'type': 'image/svg+xml',
        'purpose': 'any maskable'
    }]
}">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #00d4ff;
        --primary-glow: rgba(0, 212, 255, 0.5);
        --secondary: #6366f1;
        --accent: #fbbf24;
        --bg: #0a0e27;
        --surface: #141b3d;
        --surface-light: #1e2749;
        --text: #e2e8f0;
        --text-dark: #94a3b8;
        --success: #10b981;
        --danger: #ef4444;
        --border: rgba(100, 116, 139, 0.3);
        --glow: 0 0 20px var(--primary-glow);
        --glow-strong: 0 0 30px var(--primary-glow), 0 0 60px var(--primary-glow);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
    }

    body {
        font-family: 'Exo 2', -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
        background: var(--bg);
        background-image: 
            radial-gradient(ellipse at top, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
            radial-gradient(ellipse at bottom, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
        background-attachment: fixed;
        color: var(--text);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        padding-bottom: 90px;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
    }

    html {
        height: -webkit-fill-available;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 212, 255, 0.03) 2px,
                rgba(0, 212, 255, 0.03) 4px
            );
        pointer-events: none;
        z-index: 1;
        will-change: auto;
    }

    .header {
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
        color: white;
        padding: 1.5rem 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .header-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.75rem;
        font-weight: 900;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        background: linear-gradient(135deg, var(--primary) 0%, #fff 50%, var(--primary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 40px var(--primary-glow);
        animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .header-title::before {
        content: 'â„ï¸';
        font-size: 2rem;
        filter: drop-shadow(0 0 10px var(--primary));
        animation: rotate 8s linear infinite;
    }

    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .header-subtitle {
        font-family: 'Exo 2', sans-serif;
        font-size: 0.875rem;
        opacity: 0.8;
        margin-top: 0.5rem;
        color: var(--primary);
        font-weight: 600;
        letter-spacing: 0.05em;
    }

    .nav-tabs {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(10, 14, 39, 0.98);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(0, 212, 255, 0.3);
        z-index: 100;
        box-shadow: 0 -8px 32px rgba(0, 212, 255, 0.1);
        padding: 0.5rem;
        gap: 0.5rem;
    }

    .nav-tab {
        flex: 1;
        padding: 1rem 0.5rem;
        text-align: center;
        border: 2px solid var(--border);
        background: rgba(30, 39, 73, 0.4);
        color: var(--text-dark);
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        border-radius: 16px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        position: relative;
        overflow: hidden;
    }

    .nav-tab::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        opacity: 0;
        transition: opacity 0.4s;
    }

    .nav-tab.active {
        color: var(--primary);
        background: rgba(0, 212, 255, 0.1);
        border-color: var(--primary);
        box-shadow: var(--glow), inset 0 0 20px rgba(0, 212, 255, 0.1);
        transform: translateY(-2px);
    }

    .nav-tab.active::before {
        opacity: 0.1;
    }

    .nav-tab:active {
        transform: translateY(0) scale(0.95);
    }

    .nav-icon {
        font-size: 1.75rem;
        filter: drop-shadow(0 0 8px currentColor);
        transition: all 0.3s;
    }

    .nav-tab.active .nav-icon {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .container {
        padding: 1.5rem 1rem;
        max-width: 800px;
        margin: 0 auto;
        position: relative;
        z-index: 2;
    }

    .screen {
        display: none;
        animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .screen.active {
        display: block;
    }

    @keyframes fadeInUp {
        from { 
            opacity: 0; 
            transform: translateY(30px);
        }
        to { 
            opacity: 1; 
            transform: translateY(0);
        }
    }

    .card {
        background: rgba(20, 27, 61, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 24px;
        padding: 2rem 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease-out;
        will-change: transform;
    }

    .card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
        transition: left 0.8s;
        pointer-events: none;
    }

    .card:active {
        transform: scale(0.99);
    }

    .card-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-shadow: 0 0 20px var(--primary-glow);
    }

    .card-title::after {
        content: '';
        flex: 1;
        height: 2px;
        background: linear-gradient(to right, var(--primary), transparent);
        box-shadow: 0 0 10px var(--primary-glow);
    }

    .form-group {
        margin-bottom: 1.5rem;
        /* å…¥åŠ›æ¬„ã®ã‚¿ãƒƒãƒæ“ä½œã‚’è¨±å¯ */
        touch-action: auto;
        -webkit-touch-callout: default;
    }

    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--primary);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        user-select: text;
        -webkit-user-select: text;
    }

    .form-input {
        width: 100%;
        padding: 1rem 1.25rem;
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 16px;
        font-size: 1rem;
        transition: all 0.3s ease-out;
        background: rgba(30, 39, 73, 0.4);
        color: var(--text);
        font-family: 'Exo 2', sans-serif;
        -webkit-appearance: none;
        appearance: none;
        min-height: 52px;
        /* ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã‚’è¨±å¯ */
        user-select: text;
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        /* iOSé•·æŠ¼ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼æœ‰åŠ¹åŒ– */
        -webkit-touch-callout: default;
        /* ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆè¨±å¯ */
        touch-action: auto;
        pointer-events: auto;
    }

    .form-input::placeholder {
        color: var(--text-dark);
        user-select: none;
        -webkit-user-select: none;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(30, 39, 73, 0.6);
        box-shadow: var(--glow), inset 0 0 20px rgba(0, 212, 255, 0.05);
    }

    .form-input::selection {
        background: var(--primary);
        color: white;
    }

    .form-input::-moz-selection {
        background: var(--primary);
        color: white;
    }

    select.form-input {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2300d4ff' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 1rem center;
        padding-right: 3rem;
    }
    
    /* ãƒ©ãƒ™ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚‚è¨±å¯ */
    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--primary);
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        user-select: text;
        -webkit-user-select: text;
    }

    .btn {
        padding: 1.25rem 2rem;
        border: none;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        width: 100%;
        margin-top: 0.5rem;
        font-family: 'Exo 2', sans-serif;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        position: relative;
        overflow: hidden;
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        will-change: transform;
        min-height: 52px;
    }

    .btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s;
        pointer-events: none;
    }

    .btn:active {
        transform: scale(0.97);
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        box-shadow: 0 8px 32px rgba(0, 212, 255, 0.3), 0 0 0 1px rgba(0, 212, 255, 0.5);
        border: 2px solid transparent;
    }

    .btn-primary:active {
        box-shadow: 0 4px 16px rgba(0, 212, 255, 0.3);
    }

    .btn-secondary {
        background: rgba(30, 39, 73, 0.6);
        color: var(--primary);
        border: 2px solid var(--primary);
        box-shadow: inset 0 0 20px rgba(0, 212, 255, 0.1);
    }

    .btn-secondary:hover {
        background: rgba(0, 212, 255, 0.1);
        box-shadow: var(--glow);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        color: white;
        box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
    }

    .btn-success:hover {
        box-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
        transform: translateY(-3px);
    }

    .btn-danger {
        background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        color: white;
        box-shadow: 0 8px 32px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
        box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        transform: translateY(-3px);
    }

    .btn-small {
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
        width: auto;
    }

    .btn-time {
        padding: 1rem;
        font-size: 0.875rem;
        border-radius: 12px;
        font-weight: 600;
        background: rgba(30, 39, 73, 0.6);
        border: 2px solid rgba(0, 212, 255, 0.3);
        color: var(--text);
    }

    .btn-time.active {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        border-color: var(--success);
        color: white;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    }

    .btn-time:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .location-list {
        list-style: none;
    }

    .location-item {
        background: rgba(30, 39, 73, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 1.25rem;
        border-radius: 16px;
        margin-bottom: 1rem;
        border: 2px solid rgba(0, 212, 255, 0.2);
        border-left: 4px solid var(--primary);
        display: flex;
        justify-content: space-between;
        align-items: start;
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        will-change: transform;
    }

    .location-item:active {
        transform: scale(0.98);
        box-shadow: var(--glow), 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .location-info {
        flex: 1;
        user-select: text;
        -webkit-user-select: text;
    }

    .location-name {
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--primary);
        margin-bottom: 0.5rem;
        text-shadow: 0 0 10px var(--primary-glow);
        user-select: text;
        -webkit-user-select: text;
    }

    .location-address {
        font-size: 0.875rem;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        user-select: text;
        -webkit-user-select: text;
    }

    .location-coords {
        font-size: 0.75rem;
        color: var(--text-dark);
        font-family: 'Courier New', monospace;
        background: rgba(0, 212, 255, 0.1);
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        display: inline-block;
        user-select: text;
        -webkit-user-select: text;
        cursor: text;
    }

    .location-actions {
        display: flex;
        gap: 0.5rem;
    }

    .checkbox-item {
        background: rgba(30, 39, 73, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 1.25rem;
        border-radius: 16px;
        margin-bottom: 1rem;
        border: 2px solid rgba(0, 212, 255, 0.2);
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: pointer;
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        user-select: none;
        -webkit-user-select: none;
        will-change: transform;
        min-height: 68px;
    }

    .checkbox-item:active {
        transform: scale(0.98);
    }

    .checkbox-item.selected {
        border-color: var(--primary);
        background: rgba(0, 212, 255, 0.1);
        box-shadow: var(--glow);
    }

    .checkbox-item input[type="checkbox"] {
        width: 28px;
        height: 28px;
        cursor: pointer;
        accent-color: var(--primary);
        flex-shrink: 0;
    }

    .work-item {
        background: rgba(30, 39, 73, 0.4);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: 1.5rem;
        border-radius: 20px;
        margin-bottom: 1.5rem;
        border: 2px solid rgba(0, 212, 255, 0.2);
        border-left: 5px solid var(--secondary);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        will-change: transform;
    }

    .work-item:active {
        transform: scale(0.99);
    }

    .work-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 1rem;
        gap: 1rem;
    }

    .work-order {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        min-width: 44px;
        height: 44px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 1.25rem;
        font-family: 'Orbitron', sans-serif;
        box-shadow: 0 0 20px var(--primary-glow);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .work-name {
        flex: 1;
        padding: 0 1rem;
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--text);
        line-height: 1.3;
    }

    .work-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-top: 1rem;
    }

    .work-detail {
        background: rgba(20, 27, 61, 0.6);
        backdrop-filter: blur(10px);
        padding: 1rem;
        border-radius: 12px;
        border: 1px solid rgba(0, 212, 255, 0.2);
        transition: all 0.3s;
    }

    .work-detail:hover {
        border-color: var(--primary);
        background: rgba(20, 27, 61, 0.8);
    }

    .work-detail-label {
        font-size: 0.75rem;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
    }

    .work-detail-value {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--primary);
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 10px var(--primary-glow);
    }

    .time-input-group {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .time-input-group input {
        flex: 1;
    }

    .distance-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: linear-gradient(135deg, var(--accent) 0%, #f59e0b 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 700;
        font-family: 'Orbitron', sans-serif;
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .summary-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .summary-card {
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(99, 102, 241, 0.2) 100%);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(0, 212, 255, 0.3);
        color: white;
        padding: 1.5rem;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 8px 24px rgba(0, 212, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .summary-card:hover {
        box-shadow: var(--glow-strong);
        transform: translateY(-5px) scale(1.03);
    }

    .summary-label {
        font-size: 0.75rem;
        opacity: 0.9;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        font-weight: 600;
    }

    .summary-value {
        font-size: 2.5rem;
        font-weight: 900;
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 30px var(--primary-glow);
        line-height: 1;
    }

    .summary-unit {
        font-size: 1rem;
        opacity: 0.9;
        margin-left: 0.25rem;
        font-weight: 600;
    }

    .report-tabs {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .report-tab {
        flex: 1;
        padding: 1rem;
        border: 2px solid rgba(0, 212, 255, 0.3);
        background: rgba(30, 39, 73, 0.4);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        cursor: pointer;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        color: var(--text-dark);
    }

    .report-tab:hover {
        border-color: var(--primary);
    }

    .report-tab.active {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        border-color: var(--primary);
        box-shadow: var(--glow);
    }

    .report-table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(20, 27, 61, 0.6);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid rgba(0, 212, 255, 0.2);
    }

    .report-table th {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 1.25rem;
        text-align: left;
        font-weight: 700;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .report-table td {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        font-size: 0.875rem;
        color: var(--text);
    }

    .report-table tr:last-child td {
        border-bottom: none;
    }

    .report-table tr:hover {
        background: rgba(0, 212, 255, 0.05);
    }

    .empty-state {
        text-align: center;
        padding: 4rem 1rem;
        color: var(--text-dark);
    }

    .empty-icon {
        font-size: 5rem;
        margin-bottom: 1.5rem;
        opacity: 0.3;
        filter: drop-shadow(0 0 20px var(--primary-glow));
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        animation: fadeIn 0.3s;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: rgba(20, 27, 61, 0.95);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 24px;
        padding: 2rem 1.5rem;
        max-width: 500px;
        width: 100%;
        max-height: 85vh;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), var(--glow);
        animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        margin: auto;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .modal-header {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.5rem;
        font-weight: 900;
        margin-bottom: 1.5rem;
        color: var(--primary);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        text-shadow: 0 0 20px var(--primary-glow);
        text-align: center;
    }

    .order-controls {
        display: flex;
        gap: 0.5rem;
    }

    .order-btn {
        background: rgba(30, 39, 73, 0.6);
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 10px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: 700;
        font-size: 1.125rem;
        color: var(--primary);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .order-btn:hover:not(:disabled) {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        box-shadow: var(--glow);
        transform: scale(1.1);
    }

    .order-btn:disabled {
        opacity: 0.2;
        cursor: not-allowed;
    }

    @media print {
        .header, .nav-tabs, .btn {
            display: none;
        }
        .container {
            padding: 0;
        }
        .card {
            box-shadow: none;
            page-break-inside: avoid;
        }
    }
    
    /* ã‚¹ãƒãƒ›æœ€é©åŒ– */
    @media (max-width: 768px) {
        .container {
            padding: 1rem 0.75rem;
        }
        
        .card {
            padding: 1.5rem 1rem;
            border-radius: 20px;
        }
        
        .header-title {
            font-size: 1.5rem;
        }
        
        .summary-grid {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
        
        .summary-value {
            font-size: 2rem;
        }
        
        .report-table {
            font-size: 0.8rem;
        }
        
        .report-table th,
        .report-table td {
            padding: 0.75rem 0.5rem;
        }
        
        .work-details {
            grid-template-columns: 1fr;
        }
        
        .nav-tab {
            font-size: 0.7rem;
            padding: 0.75rem 0.25rem;
        }
        
        .nav-icon {
            font-size: 1.5rem;
        }
    }
    
    /* æ¥µå°ã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-width: 375px) {
        .header-title {
            font-size: 1.25rem;
        }
        
        .card-title {
            font-size: 1rem;
        }
        
        .btn {
            padding: 1rem 1.5rem;
            font-size: 0.9rem;
        }
        
        .summary-value {
            font-size: 1.75rem;
        }
    }
    
    /* ãƒ©ãƒ³ãƒ‰ã‚¹ã‚±ãƒ¼ãƒ—å¯¾å¿œ */
    @media (orientation: landscape) and (max-height: 500px) {
        .header {
            padding: 0.75rem 1rem;
        }
        
        .header-title {
            font-size: 1.25rem;
        }
        
        .nav-tabs {
            padding: 0.25rem;
        }
        
        .nav-tab {
            padding: 0.5rem 0.25rem;
        }
    }
    
    /* ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢å¯¾å¿œï¼ˆãƒãƒƒãƒä»˜ãã‚¹ãƒãƒ›ï¼‰ */
    @supports (padding: max(0px)) {
        body {
            padding-left: max(0px, env(safe-area-inset-left));
            padding-right: max(0px, env(safe-area-inset-right));
            padding-bottom: max(90px, env(safe-area-inset-bottom, 90px));
        }
        
        .header {
            padding-top: max(1.5rem, env(safe-area-inset-top, 1.5rem));
        }
        
        .nav-tabs {
            padding-bottom: max(0.5rem, env(safe-area-inset-bottom, 0.5rem));
        }
    }
</style>
```

</head>
<body>
    <div class="header">
        <div class="header-title">
            SNOW OPS
        </div>
        <div class="header-subtitle" id="currentDate"></div>
    </div>

```
<div class="container">
    <!-- å¥‘ç´„å…ˆç™»éŒ²ç”»é¢ -->
    <div id="screen-register" class="screen active">
        <div class="card">
            <div class="card-title">ğŸ“ æ–°è¦å¥‘ç´„å…ˆç™»éŒ²</div>
            <form id="locationForm">
                <div class="form-group">
                    <label class="form-label">å¥‘ç´„å…ˆå</label>
                    <input type="text" id="locationName" class="form-input" placeholder="ä¾‹ï¼šâ—‹â—‹å•†åº—" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ä½æ‰€</label>
                    <input type="text" id="locationAddress" class="form-input" placeholder="ä¾‹ï¼šâ—‹â—‹å¸‚â—‹â—‹ç”º1-2-3" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å˜ä¾¡ã‚¿ã‚¤ãƒ—</label>
                    <select id="priceType" class="form-input" required>
                        <option value="flat">ä¸€å¼</option>
                        <option value="hourly">æ™‚é–“å˜ä¾¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">å˜ä¾¡ï¼ˆå††ï¼‰</label>
                    <input type="number" step="1" id="priceAmount" class="form-input" placeholder="ä¾‹ï¼š10000" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    âœ… ç™»éŒ²ã™ã‚‹
                </button>
            </form>
        </div>

        <div class="card">
            <div class="card-title">ğŸ“‹ ç™»éŒ²æ¸ˆã¿å¥‘ç´„å…ˆä¸€è¦§</div>
            <ul id="locationList" class="location-list"></ul>
            
            <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.3);">
                <div style="font-size: 0.875rem; color: var(--text-dark); line-height: 1.6;">
                    <div style="font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</div>
                    <div style="margin-bottom: 0.5rem;">â€¢ <strong>ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›</strong>ï¼šå…¨ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
                    <div>â€¢ <strong>ãƒ‡ãƒ¼ã‚¿å–è¾¼</strong>ï¼šãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒã¾ãŸã¯ä»–ç«¯æœ«ã‹ã‚‰ç§»è¡Œ</div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-top: 1rem;">
                <button class="btn btn-secondary" id="exportDataBtn">
                    ğŸ“¤ ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
                </button>
                <button class="btn btn-secondary" id="importDataBtn">
                    ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å–è¾¼
                </button>
            </div>
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>
    </div>

    <!-- æœ¬æ—¥ã®é™¤é›ªä½œæ¥­ç”»é¢ -->
    <div id="screen-work" class="screen">
        <div class="card">
            <div class="card-title">ğŸšœ æœ¬æ—¥ã®é™¤é›ªä½œæ¥­</div>
            <button class="btn btn-primary" id="addWorkBtn">
                â• ä½œæ¥­ã‚’è¿½åŠ 
            </button>
        </div>

        <div id="workListContainer"></div>

        <div class="card" id="workSummaryCard" style="display: none;">
            <div class="card-title">ğŸ“Š æœ¬æ—¥ã®ä½œæ¥­ã‚µãƒãƒªãƒ¼</div>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-label">ä½œæ¥­ç®‡æ‰€</div>
                    <div class="summary-value" id="summaryLocations">0</div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">ä½œæ¥­æ™‚é–“</div>
                    <div class="summary-value">
                        <span id="summaryWorkTime">0</span>
                        <span class="summary-unit">åˆ†</span>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-label">ä¼‘æ†©æ™‚é–“</div>
                    <div class="summary-value">
                        <span id="summaryBreakTime">0</span>
                        <span class="summary-unit">åˆ†</span>
                    </div>
                </div>
            </div>
            <div class="summary-grid" style="grid-template-columns: 1fr;">
                <div class="summary-card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.3) 0%, rgba(245, 158, 11, 0.3) 100%); border-color: rgba(251, 191, 36, 0.5);">
                    <div class="summary-label">ğŸ’° æœ¬æ—¥ã®ç·å£²ä¸Š</div>
                    <div class="summary-value" style="color: var(--accent);">
                        <span style="font-size: 1.5rem;">Â¥</span>
                        <span id="summaryRevenue">0</span>
                    </div>
                </div>
            </div>
            <button class="btn btn-success" id="saveWorkBtn">
                ğŸ’¾ æœ¬æ—¥ã®ä½œæ¥­ã‚’ä¿å­˜
            </button>
            <div id="saveStatus" style="margin-top: 1rem; text-align: center; color: var(--text-dark); font-size: 0.875rem;"></div>
        </div>
    </div>

    <!-- å‡ºæ¥é«˜é›†è¨ˆç”»é¢ -->
    <div id="screen-report" class="screen">
        <div class="card">
            <div class="card-title">ğŸ“ˆ å‡ºæ¥é«˜é›†è¨ˆ</div>
            <div class="report-tabs">
                <button class="report-tab active" data-period="daily">æ—¥æ¬¡</button>
                <button class="report-tab" data-period="weekly">é€±æ¬¡</button>
                <button class="report-tab" data-period="monthly">æœˆæ¬¡</button>
            </div>
            <div id="reportContent"></div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-top: 1rem;">
                <button class="btn btn-secondary" id="exportReportBtn">
                    ğŸ–¨ï¸ å°åˆ·
                </button>
                <button class="btn btn-secondary" id="exportReportDataBtn">
                    ğŸ“¤ ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div class="nav-tabs">
    <button class="nav-tab active" data-screen="register">
        <div class="nav-icon">ğŸ“</div>
        <div>å¥‘ç´„å…ˆ</div>
    </button>
    <button class="nav-tab" data-screen="work">
        <div class="nav-icon">ğŸšœ</div>
        <div>ä½œæ¥­</div>
    </button>
    <button class="nav-tab" data-screen="report">
        <div class="nav-icon">ğŸ“ˆ</div>
        <div>é›†è¨ˆ</div>
    </button>
</div>

<!-- é™¤é›ªç®‡æ‰€é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
<!-- ä½œæ¥­è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="addWorkModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">ä½œæ¥­å…ˆã‚’é¸æŠ</div>
        <div id="addWorkLocationList" style="max-height: 60vh; overflow-y: auto;"></div>
        <button class="btn btn-secondary" id="cancelAddWorkBtn" style="margin-top: 1rem;">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
    </div>
</div>

<!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="editModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.8); z-index: 1000; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 1rem; overflow-y: auto;">
    <div style="max-width: 600px; margin: 2rem auto; background: var(--surface); border-radius: 24px; padding: 2rem; border: 2px solid rgba(0, 212, 255, 0.3); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary); font-family: 'Orbitron', sans-serif; font-size: 1.25rem; margin: 0;">âœï¸ å¥‘ç´„å…ˆã‚’ç·¨é›†</h3>
            <button onclick="closeEditModal()" style="background: none; border: none; color: var(--text); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; line-height: 1;">âœ•</button>
        </div>
        
        <form id="editLocationForm">
            <input type="hidden" id="editLocationId">
            <div class="form-group">
                <label class="form-label">å¥‘ç´„å…ˆå</label>
                <input type="text" id="editLocationName" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">ä½æ‰€</label>
                <input type="text" id="editLocationAddress" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">å˜ä¾¡ã‚¿ã‚¤ãƒ—</label>
                <select id="editPriceType" class="form-input" required>
                    <option value="flat">ä¸€å¼</option>
                    <option value="hourly">æ™‚é–“å˜ä¾¡</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">å˜ä¾¡ï¼ˆå††ï¼‰</label>
                <input type="number" step="1" id="editPriceAmount" class="form-input" required>
            </div>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                <button type="button" onclick="closeEditModal()" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="btn btn-primary">âœ… ä¿å­˜</button>
            </div>
        </form>
    </div>
</div>

<script>
    // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    const Storage = {
        get(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        },
        set(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        },
        getArray(key) {
            return this.get(key) || [];
        }
    };

    // è·é›¢è¨ˆç®—ï¼ˆãƒ’ãƒ¥ãƒ™ãƒ‹ã®å…¬å¼ï¼‰
    // æ™‚é–“å·®è¨ˆç®—ï¼ˆåˆ†ï¼‰
    function calculateTimeDiff(start, end) {
        if (!start || !end) return 0;
        const [sh, sm] = start.split(':').map(Number);
        const [eh, em] = end.split(':').map(Number);
        const startMin = sh * 60 + sm;
        const endMin = eh * 60 + em;
        return endMin - startMin;
    }

    // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatDate(date) {
        const d = new Date(date);
        return `${d.getFullYear()}/${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`;
    }

    // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', function() {
    
    // ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
    restoreWorkInProgress();
    
    // ç¾åœ¨æ—¥æ™‚è¡¨ç¤º
    function updateCurrentDate() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
        const dateElement = document.getElementById('currentDate');
        if (dateElement) {
            dateElement.textContent = now.toLocaleDateString('ja-JP', options);
        }
    }

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const screenName = tab.dataset.screen;
            
            // ã‚¿ãƒ–ã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            // ç”»é¢ã®åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenName}`).classList.add('active');
            
            // é›†è¨ˆç”»é¢ã®å ´åˆã¯ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°
            if (screenName === 'report') {
                updateReport('daily');
            }
        });
    });

    // å¥‘ç´„å…ˆç™»éŒ²
    document.getElementById('locationForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        try {
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            const name = document.getElementById('locationName').value.trim();
            const address = document.getElementById('locationAddress').value.trim();
            const priceType = document.getElementById('priceType').value;
            const priceAmount = parseFloat(document.getElementById('priceAmount').value);
            
            if (!name) {
                alert('âŒ å¥‘ç´„å…ˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!address) {
                alert('âŒ ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (isNaN(priceAmount) || priceAmount < 0) {
                alert('âŒ å˜ä¾¡ã«æ­£ã—ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const location = {
                id: Date.now(),
                name: name,
                address: address,
                priceType: priceType,
                priceAmount: priceAmount
            };
            
            const locations = Storage.getArray('locations');
            locations.push(location);
            Storage.set('locations', locations);
            
            e.target.reset();
            renderLocationList();
            alert('âœ… å¥‘ç´„å…ˆã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('å¥‘ç´„å…ˆç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    });

    // å¥‘ç´„å…ˆä¸€è¦§è¡¨ç¤º
    function renderLocationList() {
        const locations = Storage.getArray('locations');
        const list = document.getElementById('locationList');
        
        if (locations.length === 0) {
            list.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“</div>ç™»éŒ²ã•ã‚ŒãŸå¥‘ç´„å…ˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
            return;
        }
        
        list.innerHTML = locations.map(loc => {
            // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§ã®ãŸã‚ã€å˜ä¾¡æƒ…å ±ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            const priceType = loc.priceType || 'flat';
            const priceAmount = loc.priceAmount || 0;
            
            return `
            <li class="location-item">
                <div class="location-info">
                    <div class="location-name">${loc.name}</div>
                    <div class="location-address">${loc.address}</div>
                    <div style="margin-top: 0.5rem; display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(251, 191, 36, 0.2); padding: 0.25rem 0.75rem; border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.4);">
                        <span style="color: var(--accent); font-weight: 700;">ğŸ’° ${priceType === 'flat' ? 'ä¸€å¼' : 'æ™‚é–“'}</span>
                        <span style="color: var(--text); font-weight: 700; font-family: 'Orbitron', sans-serif;">${priceAmount.toLocaleString()}å††${priceType === 'hourly' ? '/æ™‚é–“' : ''}</span>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="openGoogleMaps('${loc.address.replace(/'/g, "\\'")}', '${loc.name.replace(/'/g, "\\'")}', event)" style="margin-top: 0.75rem; width: auto;">
                        ğŸ—ºï¸ ãƒãƒƒãƒ—ã§è¦‹ã‚‹
                    </button>
                </div>
                <div class="location-actions">
                    <button class="btn btn-secondary btn-small" onclick="editLocation(${loc.id})" style="margin-bottom: 0.5rem;">âœï¸ ç·¨é›†</button>
                    <button class="btn btn-danger btn-small" onclick="deleteLocation(${loc.id})">ğŸ—‘ï¸ å‰Šé™¤</button>
                </div>
            </li>
        `}).join('');
    }
    
    // Googleãƒãƒƒãƒ—ã§é–‹ã
    window.openGoogleMaps = function(address, name, event) {
        if (event) {
            event.stopPropagation();
        }
        const query = encodeURIComponent(address);
        const mapsUrl = `https://www.google.com/maps/search/${query}`;
        window.open(mapsUrl, '_blank');
    };

    // å¥‘ç´„å…ˆå‰Šé™¤
    window.deleteLocation = function(id) {
        if (!confirm('ã“ã®å¥‘ç´„å…ˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        let locations = Storage.getArray('locations');
        locations = locations.filter(loc => loc.id !== id);
        Storage.set('locations', locations);
        renderLocationList();
    };
    
    // å¥‘ç´„å…ˆç·¨é›†
    window.editLocation = function(id) {
        const locations = Storage.getArray('locations');
        const location = locations.find(loc => loc.id === id);
        
        if (!location) {
            alert('å¥‘ç´„å…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’ã‚»ãƒƒãƒˆ
        document.getElementById('editLocationId').value = location.id;
        document.getElementById('editLocationName').value = location.name;
        document.getElementById('editLocationAddress').value = location.address;
        document.getElementById('editPriceType').value = location.priceType || 'flat';
        document.getElementById('editPriceAmount').value = location.priceAmount || 0;
        
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        document.getElementById('editModal').style.display = 'block';
    };
    
    // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    window.closeEditModal = function() {
        document.getElementById('editModal').style.display = 'none';
    };
    
    // ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('editLocationForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        try {
            const id = parseInt(document.getElementById('editLocationId').value);
            const name = document.getElementById('editLocationName').value.trim();
            const address = document.getElementById('editLocationAddress').value.trim();
            const priceType = document.getElementById('editPriceType').value;
            const priceAmount = parseFloat(document.getElementById('editPriceAmount').value);
            
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!name) {
                alert('âŒ å¥‘ç´„å…ˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!address) {
                alert('âŒ ä½æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (isNaN(priceAmount) || priceAmount < 0) {
                alert('âŒ å˜ä¾¡ã«æ­£ã—ã„é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const locations = Storage.getArray('locations');
            const index = locations.findIndex(loc => loc.id === id);
            
            if (index === -1) {
                alert('âŒ å¥‘ç´„å…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
            locations[index] = {
                ...locations[index],
                name: name,
                address: address,
                priceType: priceType,
                priceAmount: priceAmount
            };
            
            Storage.set('locations', locations);
            closeEditModal();
            renderLocationList();
            alert('âœ… å¥‘ç´„å…ˆã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('å¥‘ç´„å…ˆæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    });
    
    // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    document.getElementById('exportDataBtn').addEventListener('click', () => {
        try {
            const locations = Storage.getArray('locations');
            const workRecords = Storage.getArray('workRecords');
            
            if (locations.length === 0 && workRecords.length === 0) {
                alert('âš ï¸ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const exportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                appName: 'SNOW OPS - é™¤é›ªå‡ºæ¥é«˜ç®¡ç†',
                locations: locations,
                workRecords: workRecords,
                statistics: {
                    totalLocations: locations.length,
                    totalWorkRecords: workRecords.length,
                    totalWorkDays: workRecords.length,
                    dateRange: workRecords.length > 0 ? {
                        start: workRecords[0].date,
                        end: workRecords[workRecords.length - 1].date
                    } : null
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            link.download = `snow-ops-backup-${dateStr}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(
                'âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼\n\n' +
                `ğŸ“ å¥‘ç´„å…ˆ: ${locations.length}ä»¶\n` +
                `ğŸ“Š ä½œæ¥­è¨˜éŒ²: ${workRecords.length}ä»¶\n\n` +
                'ğŸ’¡ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å…¨ãªå ´æ‰€ã«ä¿å­˜ã—ã¦ãã ã•ã„'
            );
        } catch (error) {
            console.error('Export error:', error);
            alert('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    });
    
    // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    document.getElementById('importDataBtn').addEventListener('click', () => {
        document.getElementById('importFileInput').click();
    });
    
    document.getElementById('importFileInput').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
            // ãƒ•ã‚¡ã‚¤ãƒ«åãƒã‚§ãƒƒã‚¯
            if (!file.name.endsWith('.json')) {
                throw new Error('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
            }
            
            const text = await file.text();
            let importData;
            
            try {
                importData = JSON.parse(text);
            } catch (parseError) {
                throw new Error('JSONãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
            }
            
            // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
            if (!importData.locations || !Array.isArray(importData.locations)) {
                throw new Error('å¥‘ç´„å…ˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            if (!importData.workRecords || !Array.isArray(importData.workRecords)) {
                throw new Error('ä½œæ¥­è¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
            if (importData.version && importData.version !== '1.0') {
                console.warn('ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã§ã™:', importData.version);
            }
            
            // ã‚¤ãƒ³ãƒãƒ¼ãƒˆå†…å®¹ã®ç¢ºèª
            const confirmMessage = 
                'ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å–è¾¼ç¢ºèª\n\n' +
                `ãƒ•ã‚¡ã‚¤ãƒ«: ${file.name}\n` +
                `ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚: ${importData.exportDate ? new Date(importData.exportDate).toLocaleString('ja-JP') : 'ä¸æ˜'}\n\n` +
                `ğŸ“ å¥‘ç´„å…ˆ: ${importData.locations.length}ä»¶\n` +
                `ğŸ“Š ä½œæ¥­è¨˜éŒ²: ${importData.workRecords.length}ä»¶\n\n` +
                'å–è¾¼æ–¹æ³•ã‚’é¸æŠ:\n' +
                'ã€OKã€‘: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ \n' +
                'ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€‘: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ã';
            
            const choice = confirm(confirmMessage);
            
            if (choice) {
                // è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
                const existingLocations = Storage.getArray('locations');
                const existingRecords = Storage.getArray('workRecords');
                
                // IDã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ã€æ–°ã—ã„IDã‚’å‰²ã‚Šå½“ã¦
                const maxLocationId = existingLocations.length > 0 
                    ? Math.max(...existingLocations.map(l => l.id))
                    : 0;
                
                const idMapping = {};
                const newLocations = importData.locations.map((loc, index) => {
                    const newId = maxLocationId + index + 1;
                    idMapping[loc.id] = newId;
                    return {
                        ...loc,
                        id: newId
                    };
                });
                
                // ä½œæ¥­è¨˜éŒ²ã®locationIdã‚‚æ›´æ–°
                const newRecords = importData.workRecords.map(record => ({
                    ...record,
                    locations: record.locations.map(loc => ({
                        ...loc,
                        locationId: idMapping[loc.locationId] || loc.locationId
                    }))
                }));
                
                Storage.set('locations', [...existingLocations, ...newLocations]);
                Storage.set('workRecords', [...existingRecords, ...newRecords]);
                
                alert(
                    'âœ… ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼\n\n' +
                    `ğŸ“ å¥‘ç´„å…ˆ: ${newLocations.length}ä»¶è¿½åŠ \n` +
                    `ğŸ“Š ä½œæ¥­è¨˜éŒ²: ${newRecords.length}ä»¶è¿½åŠ \n\n` +
                    `åˆè¨ˆ:\n` +
                    `å¥‘ç´„å…ˆ: ${existingLocations.length + newLocations.length}ä»¶\n` +
                    `ä½œæ¥­è¨˜éŒ²: ${existingRecords.length + newRecords.length}ä»¶`
                );
            } else {
                // ä¸Šæ›¸ããƒ¢ãƒ¼ãƒ‰
                const doubleCheck = confirm(
                    'âš ï¸ é‡è¦ãªç¢ºèª\n\n' +
                    'ç¾åœ¨ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã€\n' +
                    'ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã§ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚\n\n' +
                    'æœ¬å½“ã«ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ'
                );
                
                if (!doubleCheck) {
                    alert('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                    e.target.value = '';
                    return;
                }
                
                Storage.set('locations', importData.locations);
                Storage.set('workRecords', importData.workRecords);
                
                alert(
                    'âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã—ãŸï¼\n\n' +
                    `ğŸ“ å¥‘ç´„å…ˆ: ${importData.locations.length}ä»¶\n` +
                    `ğŸ“Š ä½œæ¥­è¨˜éŒ²: ${importData.workRecords.length}ä»¶`
                );
            }
            
            // ç”»é¢ã‚’æ›´æ–°
            renderLocationList();
            
            // é›†è¨ˆç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ›´æ–°
            const activeTab = document.querySelector('.nav-tab.active');
            if (activeTab && activeTab.dataset.screen === 'report') {
                updateReport('daily');
            }
            
        } catch (error) {
            console.error('Import error:', error);
            alert('âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ\n\n' + error.message);
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
        e.target.value = '';
    });

    // é™¤é›ªç®‡æ‰€é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
    // ä½œæ¥­ãƒªã‚¹ãƒˆã®ç®¡ç†
    let workItems = [];
    let workItemCounter = 0;
    
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
    function restoreWorkInProgress() {
        try {
            const savedWorkItems = Storage.get('workInProgress');
            const savedCounter = Storage.get('workItemCounter');
            
            if (savedWorkItems && Array.isArray(savedWorkItems)) {
                // æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚’é™¤ã„ã¦åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                workItems = savedWorkItems.map(item => ({
                    id: item.id,
                    locationId: item.locationId,
                    location: item.location
                }));
                workItemCounter = savedCounter || 0;
                
                if (workItems.length > 0) {
                    renderWorkList();
                    document.getElementById('workSummaryCard').style.display = 'block';
                    
                    // æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                    setTimeout(() => {
                        savedWorkItems.forEach(item => {
                            if (item.timeData) {
                                const workStart = document.querySelector(`.work-start[data-id="${item.id}"]`);
                                const workEnd = document.querySelector(`.work-end[data-id="${item.id}"]`);
                                const breakStart = document.querySelector(`.break-start[data-id="${item.id}"]`);
                                const breakEnd = document.querySelector(`.break-end[data-id="${item.id}"]`);
                                
                                if (workStart && item.timeData.workStart) {
                                    workStart.value = item.timeData.workStart;
                                    const display = document.querySelector(`.work-time-display[data-id="${item.id}"]`);
                                    const btn = document.querySelector(`.work-start-btn[data-id="${item.id}"]`);
                                    if (display) display.textContent = item.timeData.workStart + ' ~ ' + (item.timeData.workEnd || '--:--');
                                    if (btn) {
                                        btn.classList.add('active');
                                        btn.disabled = true;
                                        btn.innerHTML = 'âœ“ é–‹å§‹æ¸ˆ';
                                    }
                                }
                                
                                if (workEnd && item.timeData.workEnd) {
                                    workEnd.value = item.timeData.workEnd;
                                    const display = document.querySelector(`.work-time-display[data-id="${item.id}"]`);
                                    const btn = document.querySelector(`.work-end-btn[data-id="${item.id}"]`);
                                    const breakStartBtn = document.querySelector(`.break-start-btn[data-id="${item.id}"]`);
                                    if (display) display.textContent = item.timeData.workStart + ' ~ ' + item.timeData.workEnd;
                                    if (btn) {
                                        btn.classList.add('active');
                                        btn.disabled = true;
                                        btn.innerHTML = 'âœ“ çµ‚äº†æ¸ˆ';
                                    }
                                    if (breakStartBtn) breakStartBtn.disabled = false;
                                    calculateWorkDuration(item.id);
                                }
                                
                                if (breakStart && item.timeData.breakStart) {
                                    breakStart.value = item.timeData.breakStart;
                                    const display = document.querySelector(`.break-time-display[data-id="${item.id}"]`);
                                    const btn = document.querySelector(`.break-start-btn[data-id="${item.id}"]`);
                                    if (display) display.textContent = item.timeData.breakStart + ' ~ ' + (item.timeData.breakEnd || '--:--');
                                    if (btn) {
                                        btn.classList.add('active');
                                        btn.disabled = true;
                                        btn.innerHTML = 'âœ“ é–‹å§‹æ¸ˆ';
                                    }
                                }
                                
                                if (breakEnd && item.timeData.breakEnd) {
                                    breakEnd.value = item.timeData.breakEnd;
                                    const display = document.querySelector(`.break-time-display[data-id="${item.id}"]`);
                                    const btn = document.querySelector(`.break-end-btn[data-id="${item.id}"]`);
                                    if (display) display.textContent = item.timeData.breakStart + ' ~ ' + item.timeData.breakEnd;
                                    if (btn) {
                                        btn.classList.add('active');
                                        btn.disabled = true;
                                        btn.innerHTML = 'âœ“ çµ‚äº†æ¸ˆ';
                                    }
                                    calculateWorkDuration(item.id);
                                }
                            }
                        });
                        
                        calculateSummary();
                    }, 100);
                    
                    console.log('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ:', workItems.length, 'ä»¶');
                }
            }
        } catch (error) {
            console.error('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿å¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
        }
    }
    
    // ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ï¼ˆæ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã‚€ï¼‰
    function saveWorkInProgress() {
        try {
            // å„ä½œæ¥­ã®æ™‚é–“ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã¦ä¿å­˜
            const workItemsWithTime = workItems.map(item => {
                const workStart = document.querySelector(`.work-start[data-id="${item.id}"]`);
                const workEnd = document.querySelector(`.work-end[data-id="${item.id}"]`);
                const breakStart = document.querySelector(`.break-start[data-id="${item.id}"]`);
                const breakEnd = document.querySelector(`.break-end[data-id="${item.id}"]`);
                
                return {
                    ...item,
                    timeData: {
                        workStart: workStart?.value || '',
                        workEnd: workEnd?.value || '',
                        breakStart: breakStart?.value || '',
                        breakEnd: breakEnd?.value || ''
                    }
                };
            });
            
            Storage.set('workInProgress', workItemsWithTime);
            Storage.set('workItemCounter', workItemCounter);
            console.log('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ä¿å­˜ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
    }
    
    // ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
    function clearWorkInProgress() {
        try {
            localStorage.removeItem('workInProgress');
            localStorage.removeItem('workItemCounter');
            console.log('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    // ä½œæ¥­è¿½åŠ ãƒœã‚¿ãƒ³
    document.getElementById('addWorkBtn').addEventListener('click', () => {
        const locations = Storage.getArray('locations');
        
        if (locations.length === 0) {
            alert('å¥‘ç´„å…ˆã‚’å…ˆã«ç™»éŒ²ã—ã¦ãã ã•ã„');
            return;
        }
        
        const list = document.getElementById('addWorkLocationList');
        list.innerHTML = locations.map(loc => `
            <div class="checkbox-item" onclick="addWorkLocation(${loc.id})" style="cursor: pointer; padding: 1rem; margin-bottom: 0.75rem; background: rgba(30, 39, 73, 0.4); border: 2px solid rgba(0, 212, 255, 0.3); border-radius: 16px;">
                <div style="font-weight: 700; color: var(--primary); margin-bottom: 0.25rem;">${loc.name}</div>
                <div style="font-size: 0.875rem; color: var(--text-dark);">${loc.address}</div>
                <div style="margin-top: 0.5rem; font-size: 0.875rem;">
                    <span style="color: var(--accent);">ğŸ’° ${loc.priceType === 'flat' ? 'ä¸€å¼' : 'æ™‚é–“å˜ä¾¡'}</span>
                    <span style="color: var(--text); font-weight: 700; margin-left: 0.5rem;">${(loc.priceAmount || 0).toLocaleString()}å††</span>
                </div>
            </div>
        `).join('');
        
        document.getElementById('addWorkModal').classList.add('active');
    });

    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³
    document.getElementById('cancelAddWorkBtn').addEventListener('click', () => {
        document.getElementById('addWorkModal').classList.remove('active');
    });

    // ä½œæ¥­ã‚’è¿½åŠ 
    window.addWorkLocation = function(locationId) {
        try {
            const locations = Storage.getArray('locations');
            const location = locations.find(l => l.id === locationId);
            
            if (!location) {
                console.error('Location not found:', locationId);
                alert('âŒ å¥‘ç´„å…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§ã®ãŸã‚ã€å˜ä¾¡æƒ…å ±ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            if (!location.priceType) {
                location.priceType = 'flat';
                location.priceAmount = 0;
            }
            
            const workId = workItemCounter++;
            workItems.push({
                id: workId,
                locationId: location.id,
                location: location
            });
            
            document.getElementById('addWorkModal').classList.remove('active');
            renderWorkList();
            document.getElementById('workSummaryCard').style.display = 'block';
            
            // è‡ªå‹•ä¿å­˜
            saveWorkInProgress();
        } catch (error) {
            console.error('ä½œæ¥­è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ä½œæ¥­ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    };

    // ä½œæ¥­ã‚’å‰Šé™¤
    window.removeWorkItem = function(workId) {
        if (!confirm('ã“ã®ä½œæ¥­ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
        
        workItems = workItems.filter(item => item.id !== workId);
        renderWorkList();
        
        if (workItems.length === 0) {
            document.getElementById('workSummaryCard').style.display = 'none';
        }
        
        // è‡ªå‹•ä¿å­˜
        saveWorkInProgress();
    };

    // ä½œæ¥­ã‚’ä¸Šã«ç§»å‹•
    window.moveWorkUp = function(workId) {
        const index = workItems.findIndex(item => item.id === workId);
        if (index > 0) {
            [workItems[index - 1], workItems[index]] = [workItems[index], workItems[index - 1]];
            renderWorkList();
            saveWorkInProgress();
        }
    };

    // ä½œæ¥­ã‚’ä¸‹ã«ç§»å‹•
    window.moveWorkDown = function(workId) {
        const index = workItems.findIndex(item => item.id === workId);
        if (index < workItems.length - 1) {
            [workItems[index], workItems[index + 1]] = [workItems[index + 1], workItems[index]];
            renderWorkList();
            saveWorkInProgress();
        }
    };

    // ä½œæ¥­ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    // ä½œæ¥­ãƒªã‚¹ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function renderWorkList() {
        try {
            const container = document.getElementById('workListContainer');
            
            if (!container) {
                console.error('Work list container not found');
                return;
            }
            
            if (workItems.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = workItems.map((item, index) => {
                const loc = item.location;
                if (!loc) {
                    console.warn('Location not found for work item:', item);
                    return '';
                }
                
                return `
                <div class="card">
                    <div class="work-item">
                        <div class="work-header">
                            <div class="work-order">${index + 1}</div>
                            <div class="work-name">${loc.name}</div>
                            <div class="order-controls">
                                <button class="order-btn" onclick="moveWorkUp(${item.id})" ${index === 0 ? 'disabled' : ''} title="ä¸Šã«ç§»å‹•">â–²</button>
                                <button class="order-btn" onclick="moveWorkDown(${item.id})" ${index === workItems.length - 1 ? 'disabled' : ''} title="ä¸‹ã«ç§»å‹•">â–¼</button>
                                <button class="order-btn" onclick="removeWorkItem(${item.id})" style="background: var(--danger); border-color: var(--danger);" title="å‰Šé™¤">âœ•</button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 0.75rem; padding: 0.75rem; background: rgba(0, 212, 255, 0.1); border-radius: 12px; border: 1px solid rgba(0, 212, 255, 0.3);">
                            <div style="font-size: 0.875rem; color: var(--text-dark); margin-bottom: 0.5rem;">ğŸ“ ${loc.address}</div>
                            <button class="btn btn-secondary btn-small" onclick="openGoogleMaps('${loc.address.replace(/'/g, "\\'")}', '${loc.name.replace(/'/g, "\\'")}', event)" style="width: 100%;">
                                ğŸ—ºï¸ ãƒãƒƒãƒ—ã§è¦‹ã‚‹
                            </button>
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(251, 191, 36, 0.15); border-radius: 12px; border: 2px solid rgba(251, 191, 36, 0.4); display: flex; align-items: center; gap: 1rem;">
                            <div style="flex: 1;">
                                <div style="font-size: 0.75rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600;">ğŸ’° å˜ä¾¡</div>
                                <div style="font-size: 1.125rem; font-weight: 700; color: var(--accent); font-family: 'Orbitron', sans-serif;">${loc.priceAmount.toLocaleString()}å††${loc.priceType === 'hourly' ? '/æ™‚é–“' : ''}</div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 0.75rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600;">ğŸ’µ äºˆå®šé‡‘é¡</div>
                                <div class="estimated-amount" data-id="${item.id}" style="font-size: 1.125rem; font-weight: 700; color: var(--accent); font-family: 'Orbitron', sans-serif;">-</div>
                            </div>
                        </div>

                        <div style="margin-top: 1rem;">
                            <div class="work-detail-label">ğŸ”§ ä½œæ¥­æ™‚é–“</div>
                            <div style="display: flex; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <button class="btn btn-time work-start-btn" data-id="${item.id}" onclick="recordTime(this, 'work-start')" style="flex: 1;">
                                    â–¶ é–‹å§‹
                                </button>
                                <button class="btn btn-time work-end-btn" data-id="${item.id}" onclick="recordTime(this, 'work-end')" style="flex: 1;" disabled>
                                    â–  çµ‚äº†
                                </button>
                            </div>
                            <div class="work-detail-value" style="text-align: center; padding: 0.75rem; background: rgba(20, 27, 61, 0.6); border-radius: 12px; border: 1px solid rgba(0, 212, 255, 0.2);">
                                <span class="work-time-display" data-id="${item.id}">--:-- ~ --:--</span>
                            </div>
                            <input type="hidden" class="work-start" data-id="${item.id}">
                            <input type="hidden" class="work-end" data-id="${item.id}">
                        </div>

                        <div style="margin-top: 1.5rem;">
                            <div class="work-detail-label">â˜• ä¼‘æ†©æ™‚é–“</div>
                            <div style="display: flex; gap: 0.75rem; margin-bottom: 0.75rem;">
                                <button class="btn btn-time break-start-btn" data-id="${item.id}" onclick="recordTime(this, 'break-start')" style="flex: 1;" disabled>
                                    â–¶ é–‹å§‹
                                </button>
                                <button class="btn btn-time break-end-btn" data-id="${item.id}" onclick="recordTime(this, 'break-end')" style="flex: 1;" disabled>
                                    â–  çµ‚äº†
                                </button>
                            </div>
                            <div class="work-detail-value" style="text-align: center; padding: 0.75rem; background: rgba(20, 27, 61, 0.6); border-radius: 12px; border: 1px solid rgba(0, 212, 255, 0.2);">
                                <span class="break-time-display" data-id="${item.id}">--:-- ~ --:--</span>
                            </div>
                            <input type="hidden" class="break-start" data-id="${item.id}">
                            <input type="hidden" class="break-end" data-id="${item.id}">
                        </div>

                        <div style="margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(99, 102, 241, 0.1)); border-radius: 16px; border: 2px solid rgba(0, 212, 255, 0.3); text-align: center;">
                            <div class="work-detail-label">â±ï¸ æ­£å‘³æ‰€è¦æ™‚é–“</div>
                            <div class="work-detail-value work-duration" data-id="${item.id}" style="font-size: 1.5rem; margin-top: 0.5rem;">-</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        // å˜ä¾¡æƒ…å ±ã‚’ä¿å­˜ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ï¼‰
        window.currentWorkLocations = workItems.map(item => item.location);
        
        calculateSummary();
        } catch (error) {
            console.error('ä½œæ¥­ãƒªã‚¹ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼:', error);
            const container = document.getElementById('workListContainer');
            if (container) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">âŒ</div>ä½œæ¥­ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
            }
        }
    }

    // æ™‚é–“è¨˜éŒ²
    window.recordTime = function(btn, type) {
        try {
            const id = btn.dataset.id;
            if (!id) {
                console.error('No data-id found on button');
                return;
            }
            
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            if (type === 'work-start') {
                const input = document.querySelector(`.work-start[data-id="${id}"]`);
                const display = document.querySelector(`.work-time-display[data-id="${id}"]`);
                const endBtn = document.querySelector(`.work-end-btn[data-id="${id}"]`);
                
                if (!input || !display || !endBtn) {
                    console.error('Required elements not found for work-start');
                    return;
                }
                
                input.value = timeStr;
                display.textContent = timeStr + ' ~ --:--';
                btn.classList.add('active');
                btn.disabled = true;
                btn.innerHTML = 'âœ“ é–‹å§‹æ¸ˆ';
                endBtn.disabled = false;
            } else if (type === 'work-end') {
                const input = document.querySelector(`.work-end[data-id="${id}"]`);
                const startInput = document.querySelector(`.work-start[data-id="${id}"]`);
                const display = document.querySelector(`.work-time-display[data-id="${id}"]`);
                const breakStartBtn = document.querySelector(`.break-start-btn[data-id="${id}"]`);
                
                if (!input || !startInput || !display || !breakStartBtn) {
                    console.error('Required elements not found for work-end');
                    return;
                }
                
                input.value = timeStr;
                const startTime = startInput.value;
                display.textContent = startTime + ' ~ ' + timeStr;
                btn.classList.add('active');
                btn.disabled = true;
                btn.innerHTML = 'âœ“ çµ‚äº†æ¸ˆ';
                breakStartBtn.disabled = false;
                calculateWorkDuration(id);
            } else if (type === 'break-start') {
                const input = document.querySelector(`.break-start[data-id="${id}"]`);
                const display = document.querySelector(`.break-time-display[data-id="${id}"]`);
                const endBtn = document.querySelector(`.break-end-btn[data-id="${id}"]`);
                
                if (!input || !display || !endBtn) {
                    console.error('Required elements not found for break-start');
                    return;
                }
                
                input.value = timeStr;
                display.textContent = timeStr + ' ~ --:--';
                btn.classList.add('active');
                btn.disabled = true;
                btn.innerHTML = 'âœ“ é–‹å§‹æ¸ˆ';
                endBtn.disabled = false;
            } else if (type === 'break-end') {
                const input = document.querySelector(`.break-end[data-id="${id}"]`);
                const startInput = document.querySelector(`.break-start[data-id="${id}"]`);
                const display = document.querySelector(`.break-time-display[data-id="${id}"]`);
                
                if (!input || !startInput || !display) {
                    console.error('Required elements not found for break-end');
                    return;
                }
                
                input.value = timeStr;
                const startTime = startInput.value;
                display.textContent = startTime + ' ~ ' + timeStr;
                btn.classList.add('active');
                btn.disabled = true;
                btn.innerHTML = 'âœ“ çµ‚äº†æ¸ˆ';
                calculateWorkDuration(id);
            }
            
            calculateSummary();
            
            // æ™‚é–“è¨˜éŒ²ã‚’è‡ªå‹•ä¿å­˜
            saveWorkInProgress();
            
            // å…¨ä½œæ¥­ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (type === 'work-end') {
                checkAllWorkCompleted();
            }
        } catch (error) {
            console.error('æ™‚é–“è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ æ™‚é–“ã®è¨˜éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    };
    
    // å…¨ä½œæ¥­å®Œäº†ãƒã‚§ãƒƒã‚¯ã¨è‡ªå‹•ä¿å­˜
    function checkAllWorkCompleted() {
        try {
            let allCompleted = true;
            
            for (const item of workItems) {
                const workEnd = document.querySelector(`.work-end[data-id="${item.id}"]`);
                if (!workEnd || !workEnd.value) {
                    allCompleted = false;
                    break;
                }
            }
            
            if (allCompleted && workItems.length > 0) {
                // 3ç§’å¾Œã«è‡ªå‹•ä¿å­˜ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
                setTimeout(() => {
                    if (confirm('âœ… å…¨ã¦ã®ä½œæ¥­ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\næœ¬æ—¥ã®ä½œæ¥­ã‚’ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ')) {
                        document.getElementById('saveWorkBtn').click();
                    }
                }, 1000);
            }
        } catch (error) {
            console.error('å®Œäº†ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    // ä½œæ¥­æ™‚é–“è¨ˆç®—
    function calculateWorkDuration(id) {
        try {
            const startInput = document.querySelector(`.work-start[data-id="${id}"]`);
            const endInput = document.querySelector(`.work-end[data-id="${id}"]`);
            const breakStartInput = document.querySelector(`.break-start[data-id="${id}"]`);
            const breakEndInput = document.querySelector(`.break-end[data-id="${id}"]`);
            const durationDiv = document.querySelector(`.work-duration[data-id="${id}"]`);
            const estimatedAmountDiv = document.querySelector(`.estimated-amount[data-id="${id}"]`);
            
            if (!startInput || !endInput || !durationDiv) {
                console.warn('Required elements not found for work duration calculation');
                return;
            }
            
            const workTime = calculateTimeDiff(startInput.value, endInput.value);
            const breakTime = calculateTimeDiff(breakStartInput?.value, breakEndInput?.value);
            const netTime = workTime - breakTime;
            
            if (workTime > 0) {
                durationDiv.textContent = `${netTime}åˆ†${breakTime > 0 ? ' (ä¼‘æ†©' + breakTime + 'åˆ†)' : ''}`;
                
                // é‡‘é¡è¨ˆç®—
                const workItem = workItems.find(item => item.id === parseInt(id));
                if (workItem && estimatedAmountDiv) {
                    const location = workItem.location;
                    let amount = 0;
                    if (location.priceType === 'flat') {
                        amount = location.priceAmount || 0;
                    } else { // hourly
                        amount = Math.round((netTime / 60) * (location.priceAmount || 0));
                    }
                    estimatedAmountDiv.textContent = `Â¥${amount.toLocaleString()}`;
                }
            } else {
                durationDiv.textContent = '-';
                if (estimatedAmountDiv) {
                    estimatedAmountDiv.textContent = '-';
                }
            }
            
            calculateSummary();
        } catch (error) {
            console.error('ä½œæ¥­æ™‚é–“è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
        }
    }

    // ã‚µãƒãƒªãƒ¼è¨ˆç®—
    function calculateSummary() {
        const locations = workItems.length;
        let totalWorkTime = 0;
        let totalBreakTime = 0;
        let totalRevenue = 0;
        
        workItems.forEach((item) => {
            const id = item.id;
            const startInput = document.querySelector(`.work-start[data-id="${id}"]`);
            const endInput = document.querySelector(`.work-end[data-id="${id}"]`);
            const breakStartInput = document.querySelector(`.break-start[data-id="${id}"]`);
            const breakEndInput = document.querySelector(`.break-end[data-id="${id}"]`);
            
            if (!startInput) return;
            
            const workTime = calculateTimeDiff(startInput.value, endInput.value);
            const breakTime = calculateTimeDiff(breakStartInput.value, breakEndInput.value);
            
            totalWorkTime += workTime;
            totalBreakTime += breakTime;
            
            // é‡‘é¡è¨ˆç®—
            if (workTime > 0) {
                const location = item.location;
                const netTime = workTime - breakTime;
                if (location.priceType === 'flat') {
                    totalRevenue += location.priceAmount || 0;
                } else { // hourly
                    totalRevenue += Math.round((netTime / 60) * (location.priceAmount || 0));
                }
            }
        });
        
        document.getElementById('summaryLocations').textContent = locations;
        document.getElementById('summaryWorkTime').textContent = totalWorkTime - totalBreakTime;
        document.getElementById('summaryBreakTime').textContent = totalBreakTime;
        document.getElementById('summaryRevenue').textContent = totalRevenue.toLocaleString();
    }

    // ä½œæ¥­ä¿å­˜
    document.getElementById('saveWorkBtn').addEventListener('click', () => {
        const statusDiv = document.getElementById('saveStatus');
        
        try {
            statusDiv.textContent = 'ä¿å­˜ä¸­...';
            statusDiv.style.color = 'var(--primary)';
            console.log('ä¿å­˜é–‹å§‹');
            
            // ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ç¢ºèª
            if (workItems.length === 0) {
                statusDiv.textContent = 'ã‚¨ãƒ©ãƒ¼: ä¿å­˜ã™ã‚‹ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“';
                statusDiv.style.color = 'var(--danger)';
                alert('ä¿å­˜ã™ã‚‹ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const workData = {
                date: new Date().toISOString().split('T')[0],
                timestamp: Date.now(),
                locations: []
            };
            
            document.querySelectorAll('.work-item').forEach((item, index) => {
                try {
                    const location = window.currentWorkLocations[index];
                    if (!location) {
                        console.warn(`Location ${index} not found`);
                        return;
                    }
                    
                    const startInput = document.querySelector(`.work-start[data-id="${item.id}"]`);
                    const endInput = document.querySelector(`.work-end[data-id="${item.id}"]`);
                    const breakStartInput = document.querySelector(`.break-start[data-id="${item.id}"]`);
                    const breakEndInput = document.querySelector(`.break-end[data-id="${item.id}"]`);
                    
                    const workTime = calculateTimeDiff(startInput.value, endInput.value);
                    const breakTime = calculateTimeDiff(breakStartInput.value, breakEndInput.value);
                    const netTime = workTime - breakTime;
                    
                    // é‡‘é¡è¨ˆç®—
                    let amount = 0;
                    const priceType = location.priceType || 'flat';
                    const priceAmount = location.priceAmount || 0;
                    
                    if (priceType === 'flat') {
                        amount = priceAmount;
                    } else { // hourly
                        amount = Math.round((netTime / 60) * priceAmount);
                    }
                    
                    workData.locations.push({
                        locationId: location.id,
                        name: location.name,
                        workStart: startInput.value || '',
                        workEnd: endInput.value || '',
                        breakStart: breakStartInput.value || '',
                        breakEnd: breakEndInput.value || '',
                        priceType: priceType,
                        priceAmount: priceAmount,
                        calculatedAmount: amount,
                        netWorkTime: netTime
                    });
                } catch (itemError) {
                    console.error(`Error processing item ${index}:`, itemError);
                }
            });
            
            console.log('ä¿å­˜ãƒ‡ãƒ¼ã‚¿:', workData);
            
            if (workData.locations.length === 0) {
                statusDiv.textContent = 'ã‚¨ãƒ©ãƒ¼: ä¿å­˜ã™ã‚‹ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“';
                statusDiv.style.color = 'var(--danger)';
                alert('ä¿å­˜ã™ã‚‹ä½œæ¥­ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            const workRecords = Storage.getArray('workRecords');
            workRecords.push(workData);
            Storage.set('workRecords', workRecords);
            
            console.log('ä¿å­˜å®Œäº†');
            statusDiv.textContent = 'âœ… ä¿å­˜æˆåŠŸï¼';
            statusDiv.style.color = 'var(--success)';
            alert('æœ¬æ—¥ã®ä½œæ¥­ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            
            // ä½œæ¥­ãƒªã‚¹ãƒˆã¨ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
            setTimeout(() => {
                workItems = [];
                workItemCounter = 0;
                document.getElementById('workListContainer').innerHTML = '';
                document.getElementById('workSummaryCard').style.display = 'none';
                window.currentWorkLocations = null;
                statusDiv.textContent = '';
                
                // ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                clearWorkInProgress();
            }, 1500);
            
        } catch (error) {
            console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            statusDiv.textContent = 'âŒ ä¿å­˜å¤±æ•—: ' + error.message;
            statusDiv.style.color = 'var(--danger)';
            alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    });

    // ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
    function updateReport(period) {
        const workRecords = Storage.getArray('workRecords');
        const locations = Storage.getArray('locations');
        const reportContent = document.getElementById('reportContent');
        
        if (workRecords.length === 0) {
            reportContent.innerHTML = '<div class="empty-state"><div class="empty-icon">ğŸ“Š</div>ä½œæ¥­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            return;
        }
        
        let filteredRecords = workRecords;
        const now = new Date();
        
        if (period === 'weekly') {
            const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            filteredRecords = workRecords.filter(r => new Date(r.date) >= weekAgo);
        } else if (period === 'monthly') {
            const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
            filteredRecords = workRecords.filter(r => new Date(r.date) >= monthAgo);
        }
        
        // å¥‘ç´„å…ˆã”ã¨ã®é›†è¨ˆ
        const summary = {};
        filteredRecords.forEach(record => {
            record.locations.forEach(loc => {
                if (!summary[loc.locationId]) {
                    // å¥‘ç´„å…ˆæƒ…å ±ã‚’å–å¾—
                    const locationInfo = locations.find(l => l.id === loc.locationId) || {};
                    
                    summary[loc.locationId] = {
                        name: loc.name,
                        count: 0,
                        totalTime: 0,
                        totalRevenue: 0,
                        priceType: loc.priceType || locationInfo.priceType || 'flat',
                        priceAmount: loc.priceAmount || locationInfo.priceAmount || 0,
                        workDetails: []
                    };
                }
                summary[loc.locationId].count++;
                
                // æ—§ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§
                if (loc.netWorkTime !== undefined) {
                    summary[loc.locationId].totalTime += loc.netWorkTime;
                } else {
                    const workTime = calculateTimeDiff(loc.workStart, loc.workEnd);
                    const breakTime = calculateTimeDiff(loc.breakStart, loc.breakEnd);
                    summary[loc.locationId].totalTime += (workTime - breakTime);
                }
                
                // é‡‘é¡é›†è¨ˆ
                if (loc.calculatedAmount !== undefined) {
                    summary[loc.locationId].totalRevenue += loc.calculatedAmount;
                }
                
                // ä½œæ¥­è©³ç´°ã‚’ä¿å­˜
                summary[loc.locationId].workDetails.push({
                    date: record.date,
                    workStart: loc.workStart,
                    workEnd: loc.workEnd,
                    breakStart: loc.breakStart,
                    breakEnd: loc.breakEnd,
                    netWorkTime: loc.netWorkTime,
                    calculatedAmount: loc.calculatedAmount || 0
                });
            });
        });
        
        const summaryArray = Object.values(summary).map(s => ({
            ...s,
            avgTime: s.totalTime / s.count
        }));
        
        // ç·å£²ä¸Šè¨ˆç®—
        const totalRevenue = summaryArray.reduce((sum, s) => sum + s.totalRevenue, 0);
        const totalWorkTime = summaryArray.reduce((sum, s) => sum + s.totalTime, 0);
        
        reportContent.innerHTML = `
            <div style="margin-bottom: 1.5rem;">
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div style="padding: 1.25rem; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.2)); border-radius: 16px; border: 2px solid rgba(251, 191, 36, 0.4); text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--accent); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600; margin-bottom: 0.5rem;">ğŸ’° æœŸé–“ç·å£²ä¸Š</div>
                        <div style="font-size: 2rem; font-weight: 900; color: var(--accent); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 30px rgba(251, 191, 36, 0.5);">
                            Â¥${totalRevenue.toLocaleString()}
                        </div>
                    </div>
                    <div style="padding: 1.25rem; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(99, 102, 241, 0.2)); border-radius: 16px; border: 2px solid rgba(0, 212, 255, 0.3); text-align: center;">
                        <div style="font-size: 0.75rem; color: var(--primary); text-transform: uppercase; letter-spacing: 0.1em; font-weight: 600; margin-bottom: 0.5rem;">â±ï¸ ç·ä½œæ¥­æ™‚é–“</div>
                        <div style="font-size: 2rem; font-weight: 900; color: var(--primary); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);">
                            ${totalWorkTime}<span style="font-size: 1rem; opacity: 0.9; margin-left: 0.25rem;">åˆ†</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>å¥‘ç´„å…ˆ</th>
                            <th>å˜ä¾¡</th>
                            <th>ä½œæ¥­å›æ•°</th>
                            <th>ç·ä½œæ¥­æ™‚é–“</th>
                            <th>å¹³å‡æ‰€è¦æ™‚é–“</th>
                            <th>å£²ä¸Šé‡‘é¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${summaryArray.map(s => `
                            <tr style="cursor: pointer;" onclick="toggleDetails('details-${s.name.replace(/[^a-zA-Z0-9]/g, '')}')">
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 0.75rem;">â–¶</span>
                                        <strong>${s.name}</strong>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                        <span style="color: var(--accent); font-weight: 600;">${s.priceType === 'flat' ? 'ä¸€å¼' : 'æ™‚é–“'}</span>
                                        <span style="font-family: 'Orbitron', sans-serif; font-weight: 700;">Â¥${s.priceAmount.toLocaleString()}</span>
                                    </div>
                                </td>
                                <td>${s.count}å›</td>
                                <td>${s.totalTime}åˆ†</td>
                                <td>${Math.round(s.avgTime)}åˆ†</td>
                                <td style="font-weight: 700; color: var(--accent); font-family: 'Orbitron', sans-serif;">Â¥${s.totalRevenue.toLocaleString()}</td>
                            </tr>
                            <tr id="details-${s.name.replace(/[^a-zA-Z0-9]/g, '')}" style="display: none;">
                                <td colspan="6" style="background: rgba(0, 212, 255, 0.05); padding: 1.5rem;">
                                    <div style="font-weight: 700; margin-bottom: 1rem; color: var(--primary);">ğŸ“‹ ä½œæ¥­å±¥æ­´</div>
                                    <div style="display: grid; gap: 0.75rem;">
                                        ${s.workDetails.map(detail => `
                                            <div style="background: rgba(20, 27, 61, 0.6); padding: 1rem; border-radius: 12px; border: 1px solid rgba(0, 212, 255, 0.2);">
                                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                                    <div>
                                                        <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.25rem;">æ—¥ä»˜</div>
                                                        <div style="font-weight: 600;">${formatDate(detail.date)}</div>
                                                    </div>
                                                    <div>
                                                        <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.25rem;">ä½œæ¥­æ™‚é–“</div>
                                                        <div style="font-weight: 600;">${detail.workStart || '--:--'} ~ ${detail.workEnd || '--:--'}</div>
                                                    </div>
                                                    <div>
                                                        <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.25rem;">ä¼‘æ†©æ™‚é–“</div>
                                                        <div style="font-weight: 600;">${detail.breakStart || '--:--'} ~ ${detail.breakEnd || '--:--'}</div>
                                                    </div>
                                                    <div>
                                                        <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.25rem;">æ­£å‘³æ™‚é–“</div>
                                                        <div style="font-weight: 600; color: var(--primary);">${detail.netWorkTime || 0}åˆ†</div>
                                                    </div>
                                                    <div>
                                                        <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.25rem;">å£²ä¸Š</div>
                                                        <div style="font-weight: 700; color: var(--accent); font-family: 'Orbitron', sans-serif;">Â¥${detail.calculatedAmount.toLocaleString()}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        `;
    }
    
    // è©³ç´°è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
    window.toggleDetails = function(id) {
        const detailRow = document.getElementById(id);
        const isVisible = detailRow.style.display !== 'none';
        detailRow.style.display = isVisible ? 'none' : 'table-row';
        
        // çŸ¢å°ã®å‘ãã‚’å¤‰æ›´
        const parentRow = detailRow.previousElementSibling;
        const arrow = parentRow.querySelector('span');
        if (arrow) {
            arrow.textContent = isVisible ? 'â–¶' : 'â–¼';
        }
    };

    // ãƒ¬ãƒãƒ¼ãƒˆæœŸé–“ã‚¿ãƒ–
    document.querySelectorAll('.report-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.report-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            updateReport(tab.dataset.period);
        });
    });

    // PDFå‡ºåŠ›
    document.getElementById('exportReportBtn').addEventListener('click', () => {
        window.print();
    });
    
    // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    document.getElementById('exportReportDataBtn').addEventListener('click', () => {
        try {
            const activeTab = document.querySelector('.report-tab.active');
            const period = activeTab ? activeTab.dataset.period : 'daily';
            
            const workRecords = Storage.getArray('workRecords');
            const locations = Storage.getArray('locations');
            
            if (workRecords.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ä½œæ¥­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            let filteredRecords = workRecords;
            const now = new Date();
            
            if (period === 'weekly') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredRecords = workRecords.filter(r => new Date(r.date) >= weekAgo);
            } else if (period === 'monthly') {
                const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                filteredRecords = workRecords.filter(r => new Date(r.date) >= monthAgo);
            }
            
            // é›†è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
            const summary = {};
            filteredRecords.forEach(record => {
                record.locations.forEach(loc => {
                    if (!summary[loc.locationId]) {
                        const locationInfo = locations.find(l => l.id === loc.locationId) || {};
                        summary[loc.locationId] = {
                            name: loc.name,
                            count: 0,
                            totalTime: 0,
                            totalRevenue: 0,
                            priceType: loc.priceType || locationInfo.priceType || 'flat',
                            priceAmount: loc.priceAmount || locationInfo.priceAmount || 0,
                            workDetails: []
                        };
                    }
                    summary[loc.locationId].count++;
                    
                    if (loc.netWorkTime !== undefined) {
                        summary[loc.locationId].totalTime += loc.netWorkTime;
                    } else {
                        const workTime = calculateTimeDiff(loc.workStart, loc.workEnd);
                        const breakTime = calculateTimeDiff(loc.breakStart, loc.breakEnd);
                        summary[loc.locationId].totalTime += (workTime - breakTime);
                    }
                    
                    if (loc.calculatedAmount !== undefined) {
                        summary[loc.locationId].totalRevenue += loc.calculatedAmount;
                    }
                    
                    summary[loc.locationId].workDetails.push({
                        date: record.date,
                        workStart: loc.workStart,
                        workEnd: loc.workEnd,
                        breakStart: loc.breakStart,
                        breakEnd: loc.breakEnd,
                        netWorkTime: loc.netWorkTime,
                        calculatedAmount: loc.calculatedAmount || 0
                    });
                });
            });
            
            const summaryArray = Object.values(summary).map(s => ({
                ...s,
                avgTime: s.totalTime / s.count
            }));
            
            const totalRevenue = summaryArray.reduce((sum, s) => sum + s.totalRevenue, 0);
            const totalWorkTime = summaryArray.reduce((sum, s) => sum + s.totalTime, 0);
            
            const reportData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                appName: 'SNOW OPS - é™¤é›ªå‡ºæ¥é«˜ç®¡ç†',
                reportType: period,
                period: {
                    type: period === 'daily' ? 'æ—¥æ¬¡' : period === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡',
                    startDate: filteredRecords.length > 0 ? filteredRecords[0].date : null,
                    endDate: filteredRecords.length > 0 ? filteredRecords[filteredRecords.length - 1].date : null
                },
                summary: {
                    totalRevenue: totalRevenue,
                    totalWorkTime: totalWorkTime,
                    totalLocations: summaryArray.length,
                    totalWorkCount: summaryArray.reduce((sum, s) => sum + s.count, 0)
                },
                details: summaryArray,
                rawRecords: filteredRecords
            };
            
            const dataStr = JSON.stringify(reportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            const periodName = period === 'daily' ? 'æ—¥æ¬¡' : period === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡';
            link.download = `snow-ops-report-${periodName}-${dateStr}.json`;
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert(`âœ… ${periodName}ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸï¼\n\nç·å£²ä¸Š: Â¥${totalRevenue.toLocaleString()}\nç·ä½œæ¥­æ™‚é–“: ${totalWorkTime}åˆ†`);
        } catch (error) {
            console.error('Report export error:', error);
            alert('âŒ ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
    });

    // åˆæœŸåŒ–
    updateCurrentDate();
    renderLocationList();
    setInterval(updateCurrentDate, 60000);
    
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒæ­£ã—ãç™»éŒ²ã•ã‚ŒãŸã‹ç¢ºèª
    console.log('ã‚¢ãƒ—ãƒªåˆæœŸåŒ–å®Œäº†');
    console.log('saveWorkBtn:', document.getElementById('saveWorkBtn'));
    
    // å…¥åŠ›æ¬„ã§ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã‚’æ˜ç¤ºçš„ã«è¨±å¯
    document.querySelectorAll('.form-input').forEach(input => {
        // ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚’è¨±å¯
        input.addEventListener('copy', (e) => {
            e.stopPropagation();
        }, true);
        
        input.addEventListener('cut', (e) => {
            e.stopPropagation();
        }, true);
        
        input.addEventListener('paste', (e) => {
            e.stopPropagation();
        }, true);
        
        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®ä¼æ’­ã‚‚è¨±å¯
        input.addEventListener('touchstart', (e) => {
            e.stopPropagation();
        }, true);
        
        input.addEventListener('touchmove', (e) => {
            e.stopPropagation();
        }, true);
        
        input.addEventListener('touchend', (e) => {
            e.stopPropagation();
        }, true);
    });
    
    // PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡¦ç†
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ ï¼‰
        const installBtn = document.createElement('button');
        installBtn.textContent = 'ğŸ“± ã‚¢ãƒ—ãƒªåŒ–';
        installBtn.className = 'btn btn-secondary btn-small';
        installBtn.style.cssText = 'position: fixed; top: 1rem; right: 1rem; z-index: 1000; width: auto; padding: 0.5rem 1rem; font-size: 0.75rem; margin: 0;';
        
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installBtn.remove();
            }
        });
        
        document.body.appendChild(installBtn);
        
        // 3ç§’å¾Œã«ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
        setTimeout(() => {
            installBtn.style.opacity = '0';
            installBtn.style.transition = 'opacity 0.5s';
            setTimeout(() => installBtn.style.opacity = '1', 100);
        }, 3000);
    });
    
    // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
    window.addEventListener('appinstalled', () => {
        console.log('PWA installed successfully');
        deferredPrompt = null;
    });
    
    // Service Workerç™»éŒ²
    if ('serviceWorker' in navigator) {
        // Service Workerã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§ç™»éŒ²
        const swCode = `
            const CACHE_NAME = 'snow-ops-v1';
            const urlsToCache = ['./', 'https://fonts.googleapis.com', 'https://fonts.gstatic.com'];
            
            self.addEventListener('install', (event) => {
                event.waitUntil(
                    caches.open(CACHE_NAME).then((cache) => cache.addAll(urlsToCache))
                );
            });
            
            self.addEventListener('fetch', (event) => {
                event.respondWith(
                    caches.match(event.request).then((response) => {
                        return response || fetch(event.request);
                    })
                );
            });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
            .then(registration => {
                console.log('Service Worker registered:', registration);
            })
            .catch(error => {
                console.log('Service Worker registration failed:', error);
            });
    }
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–: passive event listeners
    document.addEventListener('touchstart', () => {}, { passive: true });
    document.addEventListener('touchmove', () => {}, { passive: true });
    
    // ã‚¹ãƒãƒ›ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æœ€é©åŒ–
    if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
    }
    
    // ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ™‚ã®ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
    document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
            // ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«
            console.log('App in background');
        } else {
            // ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«
            console.log('App in foreground');
            updateCurrentDate();
        }
    });
    
    // å®šæœŸçš„ãªè‡ªå‹•ä¿å­˜ï¼ˆ30ç§’ã”ã¨ï¼‰
    setInterval(() => {
        if (workItems.length > 0) {
            saveWorkInProgress();
        }
    }, 30000);
    
    // ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã‚‹å‰ã®ç¢ºèª
    window.addEventListener('beforeunload', (e) => {
        // ä½œæ¥­ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        if (workItems.length > 0) {
            saveWorkInProgress();
            
            // æœªä¿å­˜ã®ä½œæ¥­ãŒã‚ã‚‹å ´åˆã¯è­¦å‘Š
            const hasUnsavedWork = workItems.some(item => {
                const workEnd = document.querySelector(`.work-end[data-id="${item.id}"]`);
                return workEnd && workEnd.value; // çµ‚äº†æ™‚é–“ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹
            });
            
            if (hasUnsavedWork) {
                e.preventDefault();
                e.returnValue = 'æœªä¿å­˜ã®ä½œæ¥­ãŒã‚ã‚Šã¾ã™ã€‚æœ¬å½“ã«ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
                return e.returnValue;
            }
        }
    });
    
    // åˆæœŸåŒ–
    updateCurrentDate();
    renderLocationList();
    updateReport('daily');
    
    }); // DOMContentLoadedçµ‚äº†
</script>
```

</body>
</html>