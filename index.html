<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é™¤é›ªç®¡ç†">
    <meta name="theme-color" content="#0a0e27">
    <meta name="description" content="æ°‘é–“é™¤é›ªä½œæ¥­ã®å‡ºæ¥é«˜ç®¡ç†ã‚¢ãƒ—ãƒª - SNOW OPS">

```
<link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' fill='%230a0e27'/><text x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-size='256' fill='%2300d4ff'>â„ï¸</text></svg>">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>â„ï¸</text></svg>">

<title>é™¤é›ªå‡ºæ¥é«˜ç®¡ç† - SNOW OPS</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Exo+2:wght@300;400;600;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    :root {
        --primary: #00d4ff;
        --primary-glow: rgba(0, 212, 255, 0.5);
        --secondary: #6366f1;
        --accent: #fbbf24;
        --bg: #0a0e27;
        --surface: #141b3d;
        --text: #e2e8f0;
        --text-dark: #94a3b8;
        --success: #10b981;
        --danger: #ef4444;
        --border: rgba(100, 116, 139, 0.3);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: 'Exo 2', -apple-system, BlinkMacSystemFont, 'Hiragino Sans', sans-serif;
        background: var(--bg);
        background-image: 
            radial-gradient(ellipse at top, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
            radial-gradient(ellipse at bottom, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
        background-attachment: fixed;
        color: var(--text);
        line-height: 1.6;
        padding-bottom: 90px;
        min-height: 100vh;
    }

    .header {
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 212, 255, 0.1);
        color: white;
        padding: 1.5rem 1rem;
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .header-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.75rem;
        font-weight: 900;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .header-date {
        font-size: 0.875rem;
        color: var(--text-dark);
    }

    .nav-tabs {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(10, 14, 39, 0.98);
        border-top: 1px solid rgba(0, 212, 255, 0.3);
        z-index: 100;
        padding: 0.5rem;
        gap: 0.5rem;
    }

    .nav-tab {
        flex: 1;
        padding: 1rem 0.5rem;
        text-align: center;
        border: 2px solid var(--border);
        background: rgba(30, 39, 73, 0.4);
        color: var(--text-dark);
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.4s;
        border-radius: 16px;
    }

    .nav-tab.active {
        color: var(--primary);
        background: rgba(0, 212, 255, 0.1);
        border-color: var(--primary);
    }

    .container {
        padding: 1.5rem 1rem;
        max-width: 800px;
        margin: 0 auto;
    }

    .screen {
        display: none;
    }

    .screen.active {
        display: block;
    }

    .card {
        background: rgba(20, 27, 61, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(0, 212, 255, 0.2);
        border-radius: 24px;
        padding: 2rem 1.5rem;
        margin-bottom: 1.5rem;
    }

    .card-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 1.5rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--primary);
        font-size: 0.875rem;
    }

    .form-input, .form-select {
        width: 100%;
        padding: 1rem 1.25rem;
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 16px;
        font-size: 1rem;
        background: rgba(30, 39, 73, 0.4);
        color: var(--text);
        font-family: 'Exo 2', sans-serif;
    }

    .form-select {
        cursor: pointer;
    }

    .form-input::placeholder {
        color: var(--text-dark);
    }

    .btn {
        padding: 1.25rem 2rem;
        border: none;
        border-radius: 16px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        width: 100%;
        margin-top: 0.5rem;
        font-family: 'Exo 2', sans-serif;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
    }

    .btn-secondary {
        background: rgba(30, 39, 73, 0.6);
        color: var(--primary);
        border: 2px solid var(--primary);
    }

    .btn-success {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        color: white;
    }

    .btn-danger {
        background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        color: white;
    }

    .btn-warning {
        background: linear-gradient(135deg, var(--accent) 0%, #f59e0b 100%);
        color: white;
    }

    .btn:active {
        transform: scale(0.98);
    }

    .work-item {
        background: rgba(30, 39, 73, 0.6);
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 1rem;
    }

    .work-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .work-item-name {
        font-weight: 700;
        color: var(--primary);
        font-size: 1.125rem;
    }

    .work-item-delete {
        background: var(--danger);
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
    }

    .location-item {
        padding: 1rem;
        background: rgba(30, 39, 73, 0.4);
        border-radius: 16px;
        margin-bottom: 1rem;
        border: 2px solid rgba(0, 212, 255, 0.2);
    }

    .daily-report {
        background: rgba(20, 27, 61, 0.8);
        border: 2px solid var(--primary);
        border-radius: 20px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .daily-report-header {
        text-align: center;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-bottom: 2px solid var(--primary);
    }

    .daily-report-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.5rem;
        color: var(--primary);
        margin-bottom: 0.5rem;
    }

    .daily-report-date {
        font-size: 1.125rem;
        color: var(--text);
        font-weight: 700;
    }

    .daily-report-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
    }

    .daily-report-table th {
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        padding: 0.75rem 0.5rem;
        text-align: left;
        font-size: 0.75rem;
        border-bottom: 2px solid var(--primary);
    }

    .daily-report-table td {
        padding: 0.75rem 0.5rem;
        border-bottom: 1px solid rgba(0, 212, 255, 0.2);
        font-size: 0.75rem;
    }

    .daily-report-table tr:last-child td {
        border-bottom: none;
    }

    .contractor-name {
        font-weight: 700;
        color: var(--primary);
        font-size: 0.875rem;
    }

    .price-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        font-weight: 700;
        font-size: 0.75rem;
        white-space: nowrap;
    }

    .price-day {
        background: rgba(251, 191, 36, 0.2);
        color: var(--accent);
    }

    .price-night {
        background: rgba(99, 102, 241, 0.2);
        color: var(--primary);
    }

    .work-time {
        color: var(--text);
        font-weight: 600;
        font-size: 0.75rem;
    }

    .work-duration {
        color: var(--text-dark);
        font-size: 0.65rem;
        margin-top: 0.25rem;
    }

    .amount {
        font-weight: 700;
        color: var(--success);
        font-size: 0.875rem;
    }

    .daily-report-footer {
        margin-top: 1.5rem;
        padding-top: 1rem;
        border-top: 2px solid var(--primary);
    }

    .footer-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .footer-item {
        text-align: center;
    }

    .footer-label {
        font-size: 0.75rem;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
    }

    .footer-value {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.25rem;
        color: var(--primary);
        font-weight: 700;
    }

    .footer-value.amount {
        color: var(--success);
    }

    .date-selector {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .date-selector select {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid rgba(0, 212, 255, 0.3);
        border-radius: 12px;
        background: rgba(30, 39, 73, 0.6);
        color: var(--text);
        font-size: 0.875rem;
        cursor: pointer;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 200;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: var(--surface);
        border: 2px solid var(--primary);
        border-radius: 24px;
        padding: 2rem;
        max-width: 500px;
        width: 100%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .modal-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 1.5rem;
        color: var(--primary);
        margin-bottom: 1.5rem;
    }

    .no-data {
        text-align: center;
        padding: 3rem 1rem;
        color: var(--text-dark);
        font-size: 1rem;
    }

    .backup-info {
        background: rgba(0, 212, 255, 0.1);
        border: 1px solid rgba(0, 212, 255, 0.3);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        font-size: 0.875rem;
        color: var(--text-dark);
    }

    .btn-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
    }
</style>
```

</head>
<body>
    <div class="header">
        <div class="header-title">â„ï¸ SNOW OPS</div>
        <div class="header-date" id="currentDate"></div>
    </div>

```
<div class="container">
    <!-- å¥‘ç´„å…ˆç™»éŒ²ç”»é¢ -->
    <div id="screen-register" class="screen active">
        <div class="card">
            <div class="card-title">ğŸ“ æ–°è¦å¥‘ç´„å…ˆç™»éŒ²</div>
            <form id="locationForm">
                <div class="form-group">
                    <label class="form-label">å¥‘ç´„å…ˆå</label>
                    <input type="text" id="locationName" class="form-input" placeholder="ä¾‹:â—‹â—‹å•†åº—" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ä½æ‰€</label>
                    <input type="text" id="locationAddress" class="form-input" placeholder="ä¾‹:â—‹â—‹å¸‚â—‹â—‹ç”º1-2-3" required>
                </div>
                <div class="form-group">
                    <label class="form-label">å˜ä¾¡ã‚¿ã‚¤ãƒ—</label>
                    <select id="priceType" class="form-select">
                        <option value="flat">ä¸€å¼</option>
                        <option value="hourly">æ™‚é–“å˜ä¾¡</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸŒ æ˜¼é–“å˜ä¾¡(å††)</label>
                    <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.5rem;">5:00ã€œ20:00</div>
                    <input type="number" id="dayPrice" class="form-input" placeholder="ä¾‹:10000" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸŒ™ å¤œé–“å˜ä¾¡(å††)</label>
                    <div style="font-size: 0.75rem; color: var(--text-dark); margin-bottom: 0.5rem;">20:01ã€œ4:59</div>
                    <input type="number" id="nightPrice" class="form-input" placeholder="ä¾‹:15000" required>
                </div>
                <button type="submit" class="btn btn-primary">âœ… ç™»éŒ²ã™ã‚‹</button>
            </form>
        </div>

        <div class="card">
            <div class="card-title">ğŸ“‹ ç™»éŒ²æ¸ˆã¿å¥‘ç´„å…ˆä¸€è¦§</div>
            <ul id="locationList" style="list-style: none;"></ul>
        </div>

        <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ -->
        <div class="card">
            <div class="card-title">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</div>
            <div class="backup-info">
                ğŸ“Œ å¥‘ç´„å…ˆæƒ…å ±ã¨ä½œæ¥­è¨˜éŒ²ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒã§ãã¾ã™
            </div>
            <div class="btn-grid">
                <button class="btn btn-success" id="exportBackupBtn">ğŸ“¥ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
                <button class="btn btn-warning" id="importBackupBtn">ğŸ“¤ å¾©å…ƒ</button>
            </div>
            <input type="file" id="importFileInput" accept=".json" style="display: none;">
        </div>
    </div>

    <!-- æœ¬æ—¥ã®é™¤é›ªä½œæ¥­ç”»é¢ -->
    <div id="screen-work" class="screen">
        <div class="card">
            <div class="card-title">ğŸšœ æœ¬æ—¥ã®é™¤é›ªä½œæ¥­</div>
            <button class="btn btn-primary" id="addWorkBtn">â• ä½œæ¥­ã‚’è¿½åŠ </button>
        </div>
        
        <div id="workListContainer"></div>
        
        <div class="card" id="workSummaryCard" style="display: none;">
            <div class="card-title">ğŸ’¾ ä½œæ¥­ä¿å­˜</div>
            <button class="btn btn-success" id="saveWorkBtn">æœ¬æ—¥ã®ä½œæ¥­ã‚’ä¿å­˜</button>
        </div>
    </div>

    <!-- æ—¥åˆ¥é›†è¨ˆç”»é¢ -->
    <div id="screen-report" class="screen">
        <div class="card">
            <div class="card-title">ğŸ“Š æ—¥åˆ¥é›†è¨ˆ</div>
            <div class="date-selector">
                <select id="reportDateSelect" class="form-select">
                    <option value="">æ—¥ä»˜ã‚’é¸æŠ</option>
                </select>
            </div>
            <div id="reportContent"></div>
        </div>
    </div>
</div>

<!-- ä½œæ¥­è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="addWorkModal" class="modal">
    <div class="modal-content">
        <div class="modal-title">ğŸšœ ä½œæ¥­è¿½åŠ </div>
        <form id="addWorkForm">
            <div class="form-group">
                <label class="form-label">å¥‘ç´„å…ˆã‚’é¸æŠ</label>
                <select id="workLocationSelect" class="form-select" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">â° ä½œæ¥­é–‹å§‹æ™‚åˆ»</label>
                <input type="time" id="workStart" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">â° ä½œæ¥­çµ‚äº†æ™‚åˆ»</label>
                <input type="time" id="workEnd" class="form-input" required>
            </div>
            <div class="btn-grid">
                <button type="button" class="btn btn-secondary" id="cancelAddWork">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="btn btn-primary">è¿½åŠ </button>
            </div>
        </form>
    </div>
</div>

<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div class="nav-tabs">
    <button class="nav-tab active" data-screen="register">
        <div style="font-size: 1.5rem;">ğŸ“</div>
        <div>å¥‘ç´„å…ˆ</div>
    </button>
    <button class="nav-tab" data-screen="work">
        <div style="font-size: 1.5rem;">ğŸšœ</div>
        <div>ä½œæ¥­</div>
    </button>
    <button class="nav-tab" data-screen="report">
        <div style="font-size: 1.5rem;">ğŸ“Š</div>
        <div>é›†è¨ˆ</div>
    </button>
</div>

<script>
    // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    const Storage = {
        get(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        },
        set(key, value) {
            localStorage.setItem(key, JSON.stringify(value));
        },
        getArray(key) {
            return this.get(key) || [];
        }
    };

    // â‘ ä¿®æ­£: æœ¬æ—¥ã®æ—¥ä»˜ã‚’å–å¾—(0:00åŸºæº–)
    function getTodayDateString() {
        const now = new Date();
        return now.toISOString().split('T')[0];
    }

    // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
    function formatDate(dateStr) {
        const date = new Date(dateStr + 'T00:00:00');
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${month}æœˆ${day}æ—¥`;
    }

    // æ™‚åˆ»ã‹ã‚‰æ™‚é–“å¸¯åˆ¤å®šï¼ˆæ˜¼/å¤œï¼‰
    function getTimeType(timeStr) {
        const hour = parseInt(timeStr.split(':')[0]);
        if (hour >= 5 && hour <= 20) {
            return 'day';
        }
        return 'night';
    }

    // ä½œæ¥­æ™‚é–“ã‚’åˆ†å˜ä½ã§è¨ˆç®—
    function calculateWorkMinutes(startTime, endTime) {
        const [startHour, startMin] = startTime.split(':').map(Number);
        const [endHour, endMin] = endTime.split(':').map(Number);
        
        let startMinutes = startHour * 60 + startMin;
        let endMinutes = endHour * 60 + endMin;
        
        if (endMinutes < startMinutes) {
            endMinutes += 24 * 60;
        }
        
        return endMinutes - startMinutes;
    }

    // å‡ºæ¥é«˜é‡‘é¡è¨ˆç®—ï¼ˆå˜ä¾¡ Ã— åˆ†æ•° Ã· 60ï¼‰
    function calculateAmount(price, minutes) {
        return Math.round(price * minutes / 60);
    }

    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    document.getElementById('exportBackupBtn').addEventListener('click', () => {
        try {
            const backupData = {
                version: '1.0',
                exportDate: new Date().toISOString(),
                locations: Storage.getArray('locations'),
                workRecords: Storage.getArray('workRecords')
            };

            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `snow-ops-backup-${getTodayDateString()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    });

    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    document.getElementById('importBackupBtn').addEventListener('click', () => {
        document.getElementById('importFileInput').click();
    });

    document.getElementById('importFileInput').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
            try {
                const backupData = JSON.parse(event.target.result);
                
                if (!backupData.version || !backupData.locations || !backupData.workRecords) {
                    throw new Error('ç„¡åŠ¹ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«');
                }

                if (!confirm('âš ï¸ ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }

                Storage.set('locations', backupData.locations);
                Storage.set('workRecords', backupData.workRecords);

                renderLocationList();
                updateWorkLocationSelect();
                
                alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                e.target.value = '';
            } catch (error) {
                console.error('å¾©å…ƒã‚¨ãƒ©ãƒ¼:', error);
                alert('âŒ ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒã«å¤±æ•—ã—ã¾ã—ãŸ\n' + error.message);
                e.target.value = '';
            }
        };
        reader.readAsText(file);
    });

    // ç¾åœ¨æ—¥æ™‚è¡¨ç¤º
    function updateCurrentDate() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
        document.getElementById('currentDate').textContent = now.toLocaleDateString('ja-JP', options);
    }

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const screenName = tab.dataset.screen;
            
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen-${screenName}`).classList.add('active');
            
            if (screenName === 'report') {
                updateDateSelector();
            } else if (screenName === 'work') {
                renderWorkList();
            }
        });
    });

    // å¥‘ç´„å…ˆç™»éŒ²
    document.getElementById('locationForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        try {
            const location = {
                id: Date.now(),
                name: document.getElementById('locationName').value.trim(),
                address: document.getElementById('locationAddress').value.trim(),
                priceType: document.getElementById('priceType').value,
                dayPrice: parseFloat(document.getElementById('dayPrice').value),
                nightPrice: parseFloat(document.getElementById('nightPrice').value)
            };
            
            const locations = Storage.getArray('locations');
            locations.push(location);
            Storage.set('locations', locations);
            
            e.target.reset();
            renderLocationList();
            updateWorkLocationSelect();
            alert('âœ… å¥‘ç´„å…ˆã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('å¥‘ç´„å…ˆç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    });

    // å¥‘ç´„å…ˆä¸€è¦§è¡¨ç¤º
    function renderLocationList() {
        const locations = Storage.getArray('locations');
        const list = document.getElementById('locationList');
        
        if (locations.length === 0) {
            list.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-dark);">ç™»éŒ²ã•ã‚ŒãŸå¥‘ç´„å…ˆãŒã‚ã‚Šã¾ã›ã‚“</div>';
            return;
        }
        
        list.innerHTML = locations.map(loc => `
            <li class="location-item">
                <div style="font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;">${loc.name}</div>
                <div style="font-size: 0.875rem; color: var(--text-dark); margin-bottom: 0.5rem;">${loc.address}</div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem;">
                    <div style="background: rgba(251, 191, 36, 0.2); padding: 0.25rem 0.75rem; border-radius: 8px;">
                        <span style="color: var(--accent); font-weight: 700;">ğŸŒ æ˜¼:</span>
                        <span style="color: var(--text); font-weight: 700;">Â¥${loc.dayPrice.toLocaleString()}</span>
                    </div>
                    <div style="background: rgba(99, 102, 241, 0.2); padding: 0.25rem 0.75rem; border-radius: 8px;">
                        <span style="color: var(--primary); font-weight: 700;">ğŸŒ™ å¤œ:</span>
                        <span style="color: var(--text); font-weight: 700;">Â¥${loc.nightPrice.toLocaleString()}</span>
                    </div>
                </div>
            </li>
        `).join('');
    }

    // ä½œæ¥­ç®¡ç†
    let workItems = [];
    
    // å¥‘ç´„å…ˆé¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ›´æ–°
    function updateWorkLocationSelect() {
        const locations = Storage.getArray('locations');
        const select = document.getElementById('workLocationSelect');
        
        select.innerHTML = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
            locations.map(loc => `<option value="${loc.id}">${loc.name}</option>`).join('');
    }

    // ä½œæ¥­è¿½åŠ ãƒœã‚¿ãƒ³
    document.getElementById('addWorkBtn').addEventListener('click', () => {
        const locations = Storage.getArray('locations');
        
        if (locations.length === 0) {
            alert('âš ï¸ å¥‘ç´„å…ˆã‚’å…ˆã«ç™»éŒ²ã—ã¦ãã ã•ã„');
            return;
        }
        
        updateWorkLocationSelect();
        document.getElementById('addWorkModal').classList.add('active');
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    document.getElementById('cancelAddWork').addEventListener('click', () => {
        document.getElementById('addWorkModal').classList.remove('active');
        document.getElementById('addWorkForm').reset();
    });

    // ä½œæ¥­è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('addWorkForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        const locationId = parseInt(document.getElementById('workLocationSelect').value);
        const locations = Storage.getArray('locations');
        const location = locations.find(l => l.id === locationId);
        
        if (!location) {
            alert('âŒ å¥‘ç´„å…ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
        }
        
        const workItem = {
            id: Date.now(),
            location: location,
            workStart: document.getElementById('workStart').value,
            workEnd: document.getElementById('workEnd').value
        };
        
        workItems.push(workItem);
        
        document.getElementById('addWorkModal').classList.remove('active');
        document.getElementById('addWorkForm').reset();
        document.getElementById('workSummaryCard').style.display = 'block';
        
        renderWorkList();
        alert(`âœ… ${location.name}ã®ä½œæ¥­ã‚’è¿½åŠ ã—ã¾ã—ãŸ`);
    });

    // ä½œæ¥­ä¸€è¦§è¡¨ç¤º
    function renderWorkList() {
        const container = document.getElementById('workListContainer');
        
        if (workItems.length === 0) {
            container.innerHTML = '';
            return;
        }
        
        container.innerHTML = workItems.map((item, index) => `
            <div class="work-item">
                <div class="work-item-header">
                    <div class="work-item-name">${item.location.name}</div>
                    <button class="work-item-delete" onclick="deleteWorkItem(${index})">ğŸ—‘ï¸ å‰Šé™¤</button>
                </div>
                <div style="font-size: 0.875rem; color: var(--text-dark); margin-bottom: 1rem;">
                    ${item.location.address}
                </div>
                <div style="background: rgba(0, 212, 255, 0.1); padding: 1rem; border-radius: 12px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; font-size: 0.875rem;">
                        <div>
                            <div style="color: var(--text-dark); margin-bottom: 0.25rem;">â° ä½œæ¥­é–‹å§‹</div>
                            <div style="color: var(--primary); font-weight: 700; font-size: 1.125rem;">${item.workStart}</div>
                        </div>
                        <div>
                            <div style="color: var(--text-dark); margin-bottom: 0.25rem;">â° ä½œæ¥­çµ‚äº†</div>
                            <div style="color: var(--primary); font-weight: 700; font-size: 1.125rem;">${item.workEnd}</div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // ä½œæ¥­å‰Šé™¤
    function deleteWorkItem(index) {
        if (confirm('ã“ã®ä½œæ¥­ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            workItems.splice(index, 1);
            renderWorkList();
            
            if (workItems.length === 0) {
                document.getElementById('workSummaryCard').style.display = 'none';
            }
        }
    }

    // ä½œæ¥­ä¿å­˜
    document.getElementById('saveWorkBtn').addEventListener('click', () => {
        if (workItems.length === 0) {
            alert('âš ï¸ ä½œæ¥­ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“');
            return;
        }

        try {
            const workRecord = {
                date: getTodayDateString(),
                locations: workItems.map(item => ({
                    locationId: item.location.id,
                    locationName: item.location.name,
                    workStart: item.workStart,
                    workEnd: item.workEnd
                }))
            };

            const workRecords = Storage.getArray('workRecords');
            workRecords.push(workRecord);
            Storage.set('workRecords', workRecords);

            workItems = [];
            renderWorkList();
            document.getElementById('workSummaryCard').style.display = 'none';
            alert('âœ… æœ¬æ—¥ã®ä½œæ¥­ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        } catch (error) {
            console.error('ä½œæ¥­ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    });

    // æ—¥ä»˜é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³æ›´æ–°
    function updateDateSelector() {
        const workRecords = Storage.getArray('workRecords');
        const select = document.getElementById('reportDateSelect');
        
        if (workRecords.length === 0) {
            select.innerHTML = '<option value="">ä½œæ¥­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</option>';
            document.getElementById('reportContent').innerHTML = '<div class="no-data">ğŸ“­ ä½œæ¥­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            return;
        }
        
        const uniqueDates = [...new Set(workRecords.map(r => r.date))].sort().reverse();
        
        select.innerHTML = uniqueDates.map(date => 
            `<option value="${date}">${formatDate(date)}</option>`
        ).join('');
        
        select.value = uniqueDates[0];
        updateReport(uniqueDates[0]);
    }

    // æ—¥ä»˜é¸æŠå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆ
    document.getElementById('reportDateSelect').addEventListener('change', (e) => {
        if (e.target.value) {
            updateReport(e.target.value);
        }
    });

    // æ—¥åˆ¥é›†è¨ˆè¡¨ç¤º
    function updateReport(selectedDate) {
        const workRecords = Storage.getArray('workRecords');
        const locations = Storage.getArray('locations');
        const reportContent = document.getElementById('reportContent');

        const dailyRecords = workRecords.filter(r => r.date === selectedDate);
        
        if (dailyRecords.length === 0) {
            reportContent.innerHTML = '<div class="no-data">ğŸ“­ ã“ã®æ—¥ã®ä½œæ¥­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
            return;
        }

        const allWorks = dailyRecords.flatMap(record => 
            record.locations.map(loc => ({
                ...loc,
                date: record.date
            }))
        );

        let totalMinutes = 0;
        let totalAmount = 0;

        const workDetails = allWorks.map(work => {
            const location = locations.find(l => l.id === work.locationId);
            const timeType = getTimeType(work.workStart);
            const price = location ? (timeType === 'day' ? location.dayPrice : location.nightPrice) : 0;
            const minutes = calculateWorkMinutes(work.workStart, work.workEnd);
            const amount = calculateAmount(price, minutes);
            
            totalMinutes += minutes;
            totalAmount += amount;
            
            return {
                work,
                location,
                timeType,
                price,
                minutes,
                amount
            };
        });

        const totalHours = Math.floor(totalMinutes / 60);
        const remainMinutes = totalMinutes % 60;

        reportContent.innerHTML = `
            <div class="daily-report">
                <div class="daily-report-header">
                    <div class="daily-report-title">æ—¥åˆ¥é›†è¨ˆè¡¨</div>
                    <div class="daily-report-date">${formatDate(selectedDate)}</div>
                </div>
                
                <table class="daily-report-table">
                    <thead>
                        <tr>
                            <th>å¥‘ç´„å…ˆå</th>
                            <th>å˜ä¾¡</th>
                            <th>ä½œæ¥­æ™‚é–“</th>
                            <th>å‡ºæ¥é«˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${workDetails.map(detail => {
                            const priceClass = detail.timeType === 'day' ? 'price-day' : 'price-night';
                            const priceIcon = detail.timeType === 'day' ? 'ğŸŒ' : 'ğŸŒ™';
                            const hours = Math.floor(detail.minutes / 60);
                            const mins = detail.minutes % 60;
                            
                            return `
                                <tr>
                                    <td>
                                        <div class="contractor-name">${detail.work.locationName}</div>
                                    </td>
                                    <td>
                                        <span class="price-badge ${priceClass}">
                                            ${priceIcon}Â¥${detail.price.toLocaleString()}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="work-time">${detail.work.workStart}ã€œ${detail.work.workEnd}</div>
                                        <div class="work-duration">(${hours > 0 ? hours + 'æ™‚é–“' : ''}${mins}åˆ†)</div>
                                    </td>
                                    <td>
                                        <div class="amount">Â¥${detail.amount.toLocaleString()}</div>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                
                <div class="daily-report-footer">
                    <div class="footer-grid">
                        <div class="footer-item">
                            <div class="footer-label">åˆè¨ˆä½œæ¥­æ™‚é–“</div>
                            <div class="footer-value">${totalHours > 0 ? totalHours + 'h' : ''}${remainMinutes}m</div>
                        </div>
                        <div class="footer-item">
                            <div class="footer-label">åˆè¨ˆå‡ºæ¥é«˜</div>
                            <div class="footer-value amount">Â¥${totalAmount.toLocaleString()}</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // åˆæœŸåŒ–
    updateCurrentDate();
    renderLocationList();
    updateWorkLocationSelect();
    
    console.log('âœ… SNOW OPS å®Œå…¨ç‰ˆ(å‡ºæ¥é«˜é‡‘é¡è¡¨ç¤ºä»˜ã)ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
</script>
```

</body>
</html>